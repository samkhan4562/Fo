<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updatePassword, reauthenticateWithCredential, EmailAuthProvider } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, increment, collection, query, where, getDocs, addDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyByoyjFQ-iQtTpSCN3ZsW0aksLGj1Me9Yw",
            authDomain: "flappyearn-6277.firebaseapp.com",
            databaseURL: "https://flappyearn-6277-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "flappyearn-6277",
            storageBucket: "flappyearn-6277.firebasestorage.app",
            messagingSenderId: "980851759857",
            appId: "1:980851759857:web:527d6ef95a946bff7b6750",
            measurementId: "G-2WLBEBZZTP"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseAuthMethods = {
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            updatePassword,
            reauthenticateWithCredential,
            EmailAuthProvider
        };
        window.firebaseDbMethods = {
            doc,
            setDoc,
            getDoc,
            updateDoc,
            increment,
            collection,
            query,
            where,
            getDocs,
            addDoc,
            serverTimestamp: () => new Date()
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Fredoka', sans-serif;
            margin: 0;
            overflow: hidden;
            touch-action: manipulation;
            background: linear-gradient(180deg, #4dc6ff 0%, #87CEEB 100%);
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        #game-canvas {
            background: transparent;
            position: absolute;
            z-index: 10;
        }
        
        .bird {
            position: absolute;
            width: 50px;
            height: 35px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 35'%3E%3Cpath fill='%23FFD700' d='M12,17.5 C12,9 18,5 30,5 C36,5 42,9 46,17.5 C42,26 36,30 30,30 C18,30 12,26 12,17.5 Z'/%3E%3Ccircle fill='white' cx='34' cy='15' r='5'/%3E%3Ccircle fill='black' cx='36' cy='15' r='2.5'/%3E%3Cpath fill='%23FF6347' d='M18,17.5 L6,14 L6,21 Z'/%3E%3Cpath fill='%23FFA500' d='M12,17.5 C12,9 18,5 30,5 C36,5 42,9 46,17.5' stroke='%23E8A317' stroke-width='1.5'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 20;
            transition: transform 0.1s;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }
        
        .pipe {
            position: absolute;
            width: 70px;
            background-image: linear-gradient(90deg, #2E8B57 0%, #3CB371 20%, #2E8B57 40%, #3CB371 60%, #2E8B57 80%, #3CB371 100%);
            border: 4px solid #006400;
            border-radius: 6px;
            z-index: 15;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }
        
        .pipe-top {
            border-bottom: 12px solid #006400;
            border-radius: 6px 6px 12px 12px;
        }
        
        .pipe-bottom {
            border-top: 12px solid #006400;
            border-radius: 12px 12px 6px 6px;
        }
        
        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 90px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='90'%3E%3Crect width='400' height='90' fill='%238B4513'/%3E%3Crect y='0' width='400' height='25' fill='%23228B22'/%3E%3Cpath d='M0,25 L400,25' stroke='%23006400' stroke-width='2'/%3E%3Ccircle cx='50' cy='50' r='6' fill='%23D2B48C'/%3E%3Ccircle cx='120' cy='65' r='8' fill='%23D2B48C'/%3E%3Ccircle cx='200' cy='55' r='7' fill='%23D2B48C'/%3E%3Ccircle cx='280' cy='45' r='5' fill='%23D2B48C'/%3E%3Ccircle cx='350' cy='60' r='9' fill='%23D2B48C'/%3E%3C/svg%3E");
            background-repeat: repeat-x;
            z-index: 30;
        }
        
        .cloud {
            position: absolute;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 50'%3E%3Cpath fill='white' d='M10,30 Q0,30 0,20 Q0,10 10,10 Q15,0 30,5 Q40,-5 50,5 Q60,-5 70,5 Q85,0 90,10 Q100,10 100,20 Q100,30 90,30 Z' filter='drop-shadow(0 2px 3px rgba(0,0,0,0.1))'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 5;
            opacity: 0.9;
        }
        
        .menu-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            position: relative;
            overflow: hidden;
            transform: translateY(0);
        }
        
        .menu-button:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0));
            pointer-events: none;
        }
        
        .menu-button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.25);
        }
        
        .menu-button:active {
            transform: translateY(-2px) scale(0.98);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .modal {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .money-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 18px;
            font-weight: bold;
            z-index: 40;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s, color 0.2s;
        }
        
        .money-indicator.earned {
            transform: scale(1.3);
            color: #FFD700;
        }
        
        .medal {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 28px;
            margin: 0 auto;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2), inset 0 2px 4px rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }
        
        .medal:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(rgba(255,255,255,0.3), rgba(255,255,255,0));
            pointer-events: none;
        }
        
        .bronze { background: linear-gradient(45deg, #CD7F32, #FFC1A1); }
        .silver { background: linear-gradient(45deg, #C0C0C0, #E8E8E8); }
        .gold { background: linear-gradient(45deg, #FFD700, #FFF8DC); }
        .platinum { background: linear-gradient(45deg, #E5E4E2, #FFFFFF); }
        
        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes loadingFloat {
            0% { transform: translate(-50%, -50%) translateY(0px) rotate(0deg); }
            25% { transform: translate(-50%, -50%) translateY(-15px) rotate(-5deg); }
            50% { transform: translate(-50%, -50%) translateY(-20px) rotate(0deg); }
            75% { transform: translate(-50%, -50%) translateY(-15px) rotate(5deg); }
            100% { transform: translate(-50%, -50%) translateY(0px) rotate(0deg); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .floating {
            animation: float 2s ease-in-out infinite;
        }
        
        .pulsing {
            animation: pulse 2s ease-in-out infinite;
        }
        
        .game-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }
        
        .tab-button {
            position: relative;
            transition: all 0.3s;
        }
        
        .tab-button.active:after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: currentColor;
            border-radius: 3px;
        }
        
        .shop-tab-button {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: scale(1);
        }
        
        .shop-tab-button.active {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .shop-tab-button:hover {
            transform: scale(1.05);
        }
        
        .pause-button {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 40;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }
        
        .pause-button:hover {
            transform: scale(1.1);
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .profile-button {
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            transition: all 0.2s;
            border: none;
        }
        
        .profile-button:hover {
            transform: scale(1.1);
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        /* Countdown styles */
        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 45;
            backdrop-filter: blur(3px);
        }
        
        .countdown-number {
            font-size: 150px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            animation: countdownPulse 1s ease-in-out;
        }
        
        @keyframes countdownPulse {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Money indicator styles */
        .money-popup {
            position: absolute;
            font-size: 28px;
            font-weight: bold;
            z-index: 25;
            pointer-events: none;
            animation: moneyFloat 1.5s ease-out forwards;
            text-shadow: 0px 0px 5px rgba(0,0,0,0.5);
            color: #00A550; /* Rupee green color */
        }
        
        @keyframes moneyFloat {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { transform: translateY(-20px) scale(1.2); opacity: 1; }
            80% { transform: translateY(-60px) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(0.8); opacity: 0; }
        }
        
        /* Screen flash effect */
        .screen-flash {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.3);
            z-index: 35;
            pointer-events: none;
            opacity: 0;
            animation: flashAnimation 0.5s ease-out;
        }
        
        @keyframes flashAnimation {
            0% { opacity: 0.3; }
            100% { opacity: 0; }
        }
        
        /* Rupee symbol styling */
        .rupee-symbol {
            font-family: Arial, sans-serif;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        <div class="bird" id="bird"></div>
        <div class="ground" id="ground"></div>

        <div class="profile-button hidden" id="profile-button-game" style="position: absolute; top: 15px; left: 15px; z-index: 40;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        </div>
        
        <!-- Power-up buttons in game -->
        <div id="game-power-ups" class="hidden" style="position: fixed; top: 15px; right: 15px; z-index: 999;">
            <div class="flex flex-col space-y-3">
                <!-- Double Reward Button -->
                <button id="game-double-reward" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-4 px-5 rounded-xl text-lg shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 active:scale-95 cursor-pointer" style="pointer-events: auto; position: relative; z-index: 1000;" title="Double Reward - 2x Money">
                    <div class="flex items-center space-x-2">
                        <div class="relative">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <div class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold">2</div>
                        </div>
                        <span id="game-double-reward-count" class="text-xl font-extrabold">0</span>
                    </div>
                </button>
                
                <!-- Coin Collector Button -->
                <button id="game-coin-collector" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-4 px-5 rounded-xl text-lg shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 active:scale-95 cursor-pointer" style="pointer-events: auto; position: relative; z-index: 1000;" title="Coin Collector - Extra Coins">
                    <div class="flex items-center space-x-2">
                        <div class="relative">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" fill="#FFD700"/>
                                <text x="12" y="16" text-anchor="middle" font-size="12" font-weight="bold" fill="#B8860B">₹</text>
                            </svg>
                            <div class="absolute -top-1 -right-1 bg-green-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold">+</div>
                        </div>
                        <span id="game-coin-collector-count" class="text-xl font-extrabold">0</span>
                    </div>
                </button>
                
                <!-- Shield Button -->
                <button id="game-shield" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-4 px-5 rounded-xl text-lg shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 active:scale-95 cursor-pointer" style="pointer-events: auto; position: relative; z-index: 1000;" title="Shield - Protection from Pipes">
                    <div class="flex items-center space-x-2">
                        <div class="relative">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11H16V18H8V11H9.2V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.4,8.7 10.4,10V11H13.6V10C13.6,8.7 12.8,8.2 12,8.2Z" fill="#E0E7FF"/>
                                <circle cx="12" cy="14.5" r="1.5" fill="#8B5CF6"/>
                            </svg>
                            <div class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center font-bold">🛡</div>
                        </div>
                        <span id="game-shield-count" class="text-xl font-extrabold">0</span>
                    </div>
                </button>
            </div>
        </div>
        
        <!-- Active power-up timers display -->
        <div id="power-up-timers" class="hidden" style="position: absolute; top: 70px; left: 15px; z-index: 40;">
            <div id="double-reward-timer" class="hidden bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-bold mb-2">
                2x Reward: <span id="double-reward-time">30</span>s
            </div>
            <div id="coin-collector-timer" class="hidden bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-bold mb-2">
                Coins: <span id="coin-collector-time">30</span>s
            </div>
            <div id="shield-timer" class="hidden bg-purple-500 text-white px-3 py-1 rounded-full text-sm font-bold mb-2">
                Shield: <span id="shield-uses">2</span> uses
            </div>
        </div>
        
        <!-- Main menu profile button -->
        <button id="profile-button" class="hidden">Profile</button>
        

        
        <!-- Countdown overlay -->
        <div id="countdown-overlay" class="countdown-overlay hidden">
            <div id="countdown-number" class="countdown-number">3</div>
        </div>
        
        <!-- Loading Screen -->
        <div id="loading-screen" class="fixed inset-0 flex items-center justify-center z-50 hidden" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="text-center">
                <!-- Animated Bird -->
                <div class="mb-8">
                    <div class="w-32 h-32 mx-auto relative">
                        <div class="bird absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 scale-150" style="animation: loadingFloat 2s ease-in-out infinite;"></div>
                    </div>
                </div>
                
                <!-- Loading Text -->
                <h2 class="text-4xl font-bold text-white mb-4">Starting Game</h2>
                <p id="loading-status" class="text-xl text-white mb-8 opacity-90">Preparing your adventure...</p>
                
                <!-- Progress Bar -->
                <div class="w-80 bg-white bg-opacity-20 rounded-full h-4 mb-6 mx-auto">
                    <div id="loading-progress" class="bg-gradient-to-r from-yellow-400 to-orange-500 h-4 rounded-full transition-all duration-300" style="width: 0%;"></div>
                </div>
                
                <!-- Loading Dots -->
                <div class="flex justify-center space-x-2">
                    <div class="w-3 h-3 bg-white rounded-full animate-bounce" style="animation-delay: 0s;"></div>
                    <div class="w-3 h-3 bg-white rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                    <div class="w-3 h-3 bg-white rounded-full animate-bounce" style="animation-delay: 0.4s;"></div>
                </div>
            </div>
        </div>
        
        <!-- Screen flash effect container -->
        <div id="screen-flash" class="screen-flash hidden"></div>
    </div>
    
    <!-- Notification Container -->
    <div id="notification-container"></div>
    
    <!-- Auth Screen -->
    <div id="auth-screen" class="fixed inset-0 flex items-center justify-center z-50">
        <div class="bg-gradient-to-br from-blue-500 to-purple-600 p-10 rounded-3xl shadow-2xl max-w-md w-full mx-4">
            <div class="text-center">
                <div class="text-center mb-2">
                    <h1 class="text-5xl font-bold text-white drop-shadow-md">Flappy Bird</h1>
                </div>
                <h2 class="text-2xl text-white mb-8 opacity-90">Rupee Adventure</h2>
                

                
                <!-- Login Form -->
                <div id="login-form" class="space-y-4">
                    <h3 class="text-2xl font-bold text-white mb-4">Login</h3>
                    <input type="email" id="login-email" placeholder="Email" class="w-full px-4 py-3 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-white">
                    <div class="relative">
                        <input type="password" id="login-password" placeholder="Password" class="w-full px-4 py-3 pr-12 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-white">
                        <button type="button" id="toggle-login-password" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-gray-800 focus:outline-none">
                            <svg id="login-eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                            </svg>
                            <svg id="login-eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                        </button>
                    </div>
                    <button id="login-button" class="menu-button bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                        Login
                    </button>
                    <button id="show-register" class="text-white underline text-lg">Don't have an account? Register</button>
                </div>
                
                <!-- Register Form -->
                <div id="register-form" class="space-y-4 hidden">
                    <h3 class="text-2xl font-bold text-white mb-4">Register</h3>
                    <input type="text" id="register-username" placeholder="Username (unique)" class="w-full px-4 py-3 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-white">
                    <input type="email" id="register-email" placeholder="Email" class="w-full px-4 py-3 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-white">
                    <div class="relative">
                        <input type="password" id="register-password" placeholder="Password (min 6 characters)" class="w-full px-4 py-3 pr-12 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-white">
                        <button type="button" id="toggle-register-password" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-gray-800 focus:outline-none">
                            <svg id="register-eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                            </svg>
                            <svg id="register-eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                        </button>
                    </div>
                    <div class="relative">
                        <input type="password" id="register-confirm-password" placeholder="Confirm Password" class="w-full px-4 py-3 pr-12 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-white">
                        <button type="button" id="toggle-register-confirm-password" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-gray-800 focus:outline-none">
                            <svg id="register-confirm-eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                            </svg>
                            <svg id="register-confirm-eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                        </button>
                    </div>
                    <button id="register-button" class="menu-button bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                        Register
                    </button>
                    <button id="show-login" class="text-white underline text-lg">Already have an account? Login</button>
                </div>
                
                <!-- Error Message -->
                <div id="auth-error" class="hidden mt-4 bg-red-500 text-white p-3 rounded-full text-center"></div>
            </div>
        </div>
    </div>

    <!-- Main Menu -->
    <div id="main-menu" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="p-10 max-w-md w-full mx-4">
            <div class="text-center">
                <div class="text-center mb-2">
                    <h1 class="text-5xl font-bold text-white drop-shadow-md">Flappy Bird</h1>
                </div>
                <h2 class="text-2xl text-white mb-8 opacity-90">Rupee Adventure</h2>
                
                <!-- User Info -->
                <div class="bg-white bg-opacity-20 rounded-xl p-4 mb-6">
                    <div class="text-white text-lg">Welcome back!</div>
                    <div id="user-username" class="text-white text-lg font-bold"></div>
                    <div id="user-email" class="text-white text-sm opacity-80"></div>
                    <div class="text-white text-xl font-bold mt-2">Total Balance: <span id="user-balance">₹0.00</span></div>
                </div>
                
                <!-- Profile button in top left -->
                <button id="profile-button-main" class="profile-button" style="position: absolute; top: 15px; left: 15px; z-index: 40;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </button>
                
                <div class="mb-10 relative">
                    <div class="w-40 h-40 mx-auto relative floating">
                        <div class="bird absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%) scale(2.5);"></div>
                    </div>
                </div>
                
                <!-- Shopping button in top right -->
                <button id="shopping-button" class="absolute top-4 right-4 bg-gradient-to-r from-purple-500 via-pink-500 to-purple-600 hover:from-purple-600 hover:via-pink-600 hover:to-purple-700 text-white font-bold p-4 rounded-2xl text-lg z-40 shadow-2xl transform hover:scale-110 transition-all duration-300 border-3 border-white/30 backdrop-blur-sm group" title="Power-up Shop">
                    <div class="flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 group-hover:animate-bounce" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                        </svg>
                        <span class="hidden sm:block font-extrabold">Shop</span>
                    </div>
                </button>
                
                <!-- Withdrawal History button -->
                <button id="withdrawal-history-button" class="absolute top-24 right-4 bg-gradient-to-r from-green-500 via-emerald-500 to-green-600 hover:from-green-600 hover:via-emerald-600 hover:to-green-700 text-white font-bold p-4 rounded-2xl text-lg z-40 shadow-2xl transform hover:scale-110 transition-all duration-300 border-3 border-white/30 backdrop-blur-sm group" title="Withdrawal History">
                    <div class="flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 group-hover:animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg>
                        <span class="hidden sm:block font-extrabold text-sm">History</span>
                    </div>
                </button>
                
                <div class="space-y-4">
                    <button id="play-button" class="menu-button bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                        Play Game
                    </button>
                    <button id="how-to-play-button" class="menu-button bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                        How to Play
                    </button>
                    <button id="high-scores-button" class="menu-button bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                        High Earnings
                    </button>
                    <button id="withdrawal-button" class="menu-button bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                        Withdrawal
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Difficulty Selection -->
    <div id="difficulty-menu" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="bg-gradient-to-br from-blue-500 to-purple-600 p-10 rounded-3xl shadow-2xl max-w-md w-full mx-4">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-white mb-8 drop-shadow-md">Select Difficulty</h2>
                
                <div class="space-y-4">
                    <button id="easy-button" class="menu-button bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                        Easy (₹0.05 per pipe)
                    </button>
                    <button id="normal-button" class="menu-button bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                        Normal (₹0.10 per pipe)
                    </button>
                    <button id="hard-button" class="menu-button bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                        Hard (₹0.20 per pipe)
                    </button>
                    <button id="back-from-difficulty" class="menu-button bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-full w-full mt-4">
                        Back
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shopping Menu -->
    <div id="shopping-menu" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="bg-gradient-to-br from-purple-500 via-pink-500 to-purple-600 p-8 rounded-3xl shadow-2xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto border-2 border-white/20 backdrop-blur-sm">
            <div class="text-center">
                <h2 class="text-4xl font-bold text-white mb-2 drop-shadow-md">🛒 Power-up Shop</h2>
                <p class="text-white text-lg mb-6 opacity-90">Buy power-ups for different difficulties</p>
                
                <!-- Difficulty Tabs -->
                <div class="flex justify-center space-x-2 mb-6">
                    <button id="shop-easy-tab" class="shop-tab-button px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded-full text-sm transition-all duration-300 active">
                        Easy (₹1)
                    </button>
                    <button id="shop-normal-tab" class="shop-tab-button px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white font-bold rounded-full text-sm transition-all duration-300">
                        Normal (₹2)
                    </button>
                    <button id="shop-hard-tab" class="shop-tab-button px-4 py-2 bg-red-500 hover:bg-red-600 text-white font-bold rounded-full text-sm transition-all duration-300">
                        Hard (₹3)
                    </button>
                </div>
                
                <!-- Easy Shop Content -->
                <div id="shop-easy-content" class="space-y-4">
                    <!-- Double Reward Power-up -->
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 border border-green-300/30">
                        <div class="flex items-center mb-3">
                            <div class="bg-yellow-500 p-2 rounded-full mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                                </svg>
                            </div>
                            <div class="text-left flex-grow">
                                <h3 class="text-white font-bold text-lg">Double Reward</h3>
                                <p class="text-white text-sm opacity-80">Get 2x money for 30 seconds</p>
                                <p class="text-white text-xs opacity-60">Owned: <span id="easy-double-reward-count">0</span></p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="shop-easy-double-reward-buy" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Buy ₹1
                            </button>
                            <button id="shop-easy-double-reward-ad" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Watch Ad
                            </button>
                        </div>
                    </div>

                    <!-- Coin Collector Power-up -->
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 border border-green-300/30">
                        <div class="flex items-center mb-3">
                            <div class="bg-orange-500 p-2 rounded-full mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                                </svg>
                            </div>
                            <div class="text-left flex-grow">
                                <h3 class="text-white font-bold text-lg">Coin Collector</h3>
                                <p class="text-white text-sm opacity-80">Collect bonus coins for 30 seconds</p>
                                <p class="text-white text-xs opacity-60">Owned: <span id="easy-coin-collector-count">0</span></p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="shop-easy-coin-collector-buy" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Buy ₹1
                            </button>
                            <button id="shop-easy-coin-collector-ad" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Watch Ad
                            </button>
                        </div>
                    </div>

                    <!-- Shield Power-up -->
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 border border-green-300/30">
                        <div class="flex items-center mb-3">
                            <div class="bg-purple-500 p-2 rounded-full mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                            </div>
                            <div class="text-left flex-grow">
                                <h3 class="text-white font-bold text-lg">Emergency Shield</h3>
                                <p class="text-white text-sm opacity-80">Pass through 2 pipes safely</p>
                                <p class="text-white text-xs opacity-60">Owned: <span id="easy-shield-count">0</span></p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="shop-easy-shield-buy" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Buy ₹1
                            </button>
                            <button id="shop-easy-shield-ad" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Watch Ad
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Normal Shop Content -->
                <div id="shop-normal-content" class="space-y-4 hidden">
                    <!-- Double Reward Power-up -->
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 border border-yellow-300/30">
                        <div class="flex items-center mb-3">
                            <div class="bg-yellow-500 p-2 rounded-full mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                                </svg>
                            </div>
                            <div class="text-left flex-grow">
                                <h3 class="text-white font-bold text-lg">Double Reward</h3>
                                <p class="text-white text-sm opacity-80">Get 2x money for 30 seconds</p>
                                <p class="text-white text-xs opacity-60">Owned: <span id="normal-double-reward-count">0</span></p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="shop-normal-double-reward-buy" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Buy ₹2
                            </button>
                            <button id="shop-normal-double-reward-ad" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Watch Ad
                            </button>
                        </div>
                    </div>

                    <!-- Coin Collector Power-up -->
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 border border-yellow-300/30">
                        <div class="flex items-center mb-3">
                            <div class="bg-orange-500 p-2 rounded-full mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                                </svg>
                            </div>
                            <div class="text-left flex-grow">
                                <h3 class="text-white font-bold text-lg">Coin Collector</h3>
                                <p class="text-white text-sm opacity-80">Collect bonus coins for 30 seconds</p>
                                <p class="text-white text-xs opacity-60">Owned: <span id="normal-coin-collector-count">0</span></p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="shop-normal-coin-collector-buy" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Buy ₹2
                            </button>
                            <button id="shop-normal-coin-collector-ad" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Watch Ad
                            </button>
                        </div>
                    </div>

                    <!-- Shield Power-up -->
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 border border-yellow-300/30">
                        <div class="flex items-center mb-3">
                            <div class="bg-purple-500 p-2 rounded-full mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                            </div>
                            <div class="text-left flex-grow">
                                <h3 class="text-white font-bold text-lg">Emergency Shield</h3>
                                <p class="text-white text-sm opacity-80">Pass through 2 pipes safely</p>
                                <p class="text-white text-xs opacity-60">Owned: <span id="normal-shield-count">0</span></p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="shop-normal-shield-buy" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Buy ₹2
                            </button>
                            <button id="shop-normal-shield-ad" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Watch Ad
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Hard Shop Content -->
                <div id="shop-hard-content" class="space-y-4 hidden">
                    <!-- Double Reward Power-up -->
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 border border-red-300/30">
                        <div class="flex items-center mb-3">
                            <div class="bg-yellow-500 p-2 rounded-full mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                                </svg>
                            </div>
                            <div class="text-left flex-grow">
                                <h3 class="text-white font-bold text-lg">Double Reward</h3>
                                <p class="text-white text-sm opacity-80">Get 2x money for 30 seconds</p>
                                <p class="text-white text-xs opacity-60">Owned: <span id="hard-double-reward-count">0</span></p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="shop-hard-double-reward-buy" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Buy ₹3
                            </button>
                            <button id="shop-hard-double-reward-ad" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Watch Ad
                            </button>
                        </div>
                    </div>

                    <!-- Coin Collector Power-up -->
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 border border-red-300/30">
                        <div class="flex items-center mb-3">
                            <div class="bg-orange-500 p-2 rounded-full mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                                </svg>
                            </div>
                            <div class="text-left flex-grow">
                                <h3 class="text-white font-bold text-lg">Coin Collector</h3>
                                <p class="text-white text-sm opacity-80">Collect bonus coins for 30 seconds</p>
                                <p class="text-white text-xs opacity-60">Owned: <span id="hard-coin-collector-count">0</span></p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="shop-hard-coin-collector-buy" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Buy ₹3
                            </button>
                            <button id="shop-hard-coin-collector-ad" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Watch Ad
                            </button>
                        </div>
                    </div>

                    <!-- Shield Power-up -->
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 border border-red-300/30">
                        <div class="flex items-center mb-3">
                            <div class="bg-purple-500 p-2 rounded-full mr-3">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                            </div>
                            <div class="text-left flex-grow">
                                <h3 class="text-white font-bold text-lg">Emergency Shield</h3>
                                <p class="text-white text-sm opacity-80">Pass through 2 pipes safely</p>
                                <p class="text-white text-xs opacity-60">Owned: <span id="hard-shield-count">0</span></p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="shop-hard-shield-buy" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Buy ₹3
                            </button>
                            <button id="shop-hard-shield-ad" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full text-sm transition-all duration-300 transform hover:scale-105">
                                Watch Ad
                            </button>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <button id="back-from-shopping" class="menu-button bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-full w-full">
                        Back to Menu
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- How to Play -->
    <div id="how-to-play" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">How to Play</h2>
            
            <div class="space-y-5 mb-8">
                <div class="flex items-start">
                    <div class="bg-blue-100 p-3 rounded-full mr-4 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" />
                        </svg>
                    </div>
                    <p class="text-gray-700 text-lg">Tap the screen or press SPACE to make the bird fly upward.</p>
                </div>
                
                <div class="flex items-start">
                    <div class="bg-green-100 p-3 rounded-full mr-4 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <p class="text-gray-700 text-lg">Navigate through pipes without hitting them.</p>
                </div>
                
                <div class="flex items-start">
                    <div class="bg-yellow-100 p-3 rounded-full mr-4 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <p class="text-gray-700 text-lg">Earn rupees for each pipe you pass:</p>
                    <ul class="ml-2 text-gray-700">
                        <li>Easy: ₹0.05 per pipe</li>
                        <li>Normal: ₹0.10 per pipe</li>
                        <li>Hard: ₹0.20 per pipe</li>
                    </ul>
                </div>
                
                <div class="flex items-start">
                    <div class="bg-red-100 p-3 rounded-full mr-4 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>
                    <p class="text-gray-700 text-lg">Don't hit the ground or the pipes, or it's game over!</p>
                </div>
            </div>
            
            <div class="text-center">
                <button id="back-from-how-to" class="menu-button bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-8 rounded-full text-lg">
                    Got it!
                </button>
            </div>
        </div>
    </div>
    
    <!-- High Earnings -->
    <div id="high-scores" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">High Earnings</h2>
            
            <div class="mb-6">
                <div class="flex justify-center space-x-6 mb-6">
                    <button id="easy-scores-tab" class="tab-button px-4 py-2 text-green-600 font-bold text-lg active">Easy</button>
                    <button id="normal-scores-tab" class="tab-button px-4 py-2 text-yellow-600 font-bold text-lg">Normal</button>
                    <button id="hard-scores-tab" class="tab-button px-4 py-2 text-red-600 font-bold text-lg">Hard</button>
                </div>
                
                <div id="easy-scores-content" class="space-y-4">
                    <div class="flex items-center bg-gradient-to-r from-yellow-50 to-yellow-100 p-4 rounded-xl shadow">
                        <div class="medal gold mr-4 flex-shrink-0">1</div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl">Highest Earnings</div>
                            <div class="text-gray-600 text-lg" id="easy-high-score">₹0.00</div>
                        </div>
                    </div>
                    <div class="flex items-center bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-xl shadow">
                        <div class="medal silver mr-4 flex-shrink-0">2</div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl">Second Best</div>
                            <div class="text-gray-600 text-lg" id="easy-second-score">₹0.00</div>
                        </div>
                    </div>
                    <div class="flex items-center bg-gradient-to-r from-orange-50 to-orange-100 p-4 rounded-xl shadow">
                        <div class="medal bronze mr-4 flex-shrink-0">3</div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl">Third Best</div>
                            <div class="text-gray-600 text-lg" id="easy-third-score">₹0.00</div>
                        </div>
                    </div>
                </div>
                
                <div id="normal-scores-content" class="space-y-4 hidden">
                    <div class="flex items-center bg-gradient-to-r from-yellow-50 to-yellow-100 p-4 rounded-xl shadow">
                        <div class="medal gold mr-4 flex-shrink-0">1</div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl">Highest Earnings</div>
                            <div class="text-gray-600 text-lg" id="normal-high-score">₹0.00</div>
                        </div>
                    </div>
                    <div class="flex items-center bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-xl shadow">
                        <div class="medal silver mr-4 flex-shrink-0">2</div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl">Second Best</div>
                            <div class="text-gray-600 text-lg" id="normal-second-score">₹0.00</div>
                        </div>
                    </div>
                    <div class="flex items-center bg-gradient-to-r from-orange-50 to-orange-100 p-4 rounded-xl shadow">
                        <div class="medal bronze mr-4 flex-shrink-0">3</div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl">Third Best</div>
                            <div class="text-gray-600 text-lg" id="normal-third-score">₹0.00</div>
                        </div>
                    </div>
                </div>
                
                <div id="hard-scores-content" class="space-y-4 hidden">
                    <div class="flex items-center bg-gradient-to-r from-yellow-50 to-yellow-100 p-4 rounded-xl shadow">
                        <div class="medal gold mr-4 flex-shrink-0">1</div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl">Highest Earnings</div>
                            <div class="text-gray-600 text-lg" id="hard-high-score">₹0.00</div>
                        </div>
                    </div>
                    <div class="flex items-center bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-xl shadow">
                        <div class="medal silver mr-4 flex-shrink-0">2</div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl">Second Best</div>
                            <div class="text-gray-600 text-lg" id="hard-second-score">₹0.00</div>
                        </div>
                    </div>
                    <div class="flex items-center bg-gradient-to-r from-orange-50 to-orange-100 p-4 rounded-xl shadow">
                        <div class="medal bronze mr-4 flex-shrink-0">3</div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl">Third Best</div>
                            <div class="text-gray-600 text-lg" id="hard-third-score">₹0.00</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button id="back-from-high-scores" class="menu-button bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-8 rounded-full text-lg">
                    Back
                </button>
            </div>
        </div>
    </div>
    
    <!-- Game History -->
    <div id="game-history" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Game History</h2>
            
            <div id="history-container" class="space-y-4 mb-6 max-h-96 overflow-y-auto pr-2">
                <div class="text-center text-gray-500 py-8" id="no-history-message">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <p class="text-lg">No games played yet.</p>
                    <p>Your game history will appear here.</p>
                </div>
            </div>
            
            <div class="text-center">
                <button id="back-from-game-history" class="menu-button bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-8 rounded-full text-lg">
                    Back
                </button>
            </div>
        </div>
    </div>
    
    <!-- Game Over -->
    <div id="game-over" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4">
            <h2 class="text-4xl font-bold text-center mb-4 text-gray-800">Game Over</h2>
            
            <div class="text-center mb-8">
                <div id="game-over-medal" class="medal gold mx-auto mb-6 pulsing">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                    </svg>
                </div>
                
                <div class="text-3xl font-bold mb-2" id="final-earnings">Earned: ₹0.00</div>
                <div class="text-gray-600 mb-2 text-lg" id="difficulty-display">Difficulty: Normal</div>
                
                <div class="bg-gray-100 p-4 rounded-xl mb-4">
                    <div class="flex justify-between items-center">
                        <span class="font-bold text-lg">Best Earnings:</span>
                        <span id="best-earnings-display" class="text-lg">₹0.00</span>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-4">
                <button id="play-again-button" class="menu-button flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-6 rounded-full text-lg">
                    Play Again
                </button>
                <button id="main-menu-button" class="menu-button flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-full text-lg">
                    Main Menu
                </button>
            </div>
        </div>
    </div>
    
    <!-- Withdrawal Menu -->
    <div id="withdrawal-menu" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Withdrawal</h2>
            
            <div class="text-center mb-6">
                <div class="bg-gradient-to-r from-green-100 to-green-200 p-6 rounded-xl mb-6">
                    <div class="text-lg text-gray-700 mb-2">Total Balance</div>
                    <div class="text-4xl font-bold text-green-600" id="total-balance">₹0.00</div>
                </div>
                
                <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-xl mb-6">
                    <div class="flex items-center justify-center mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <span class="font-bold text-yellow-800">Minimum Withdrawal</span>
                    </div>
                    <div class="text-2xl font-bold text-yellow-800">₹100.00</div>
                </div>
                
                <!-- Withdrawal Amount Input -->
                <div class="mb-6">
                    <label for="withdrawal-amount" class="block text-lg font-bold text-gray-700 mb-2">Enter Withdrawal Amount</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 text-lg font-bold">₹</span>
                        <input type="number" id="withdrawal-amount" placeholder="0.00" min="100" step="0.01" class="w-full pl-8 pr-4 py-3 rounded-full text-gray-800 text-lg font-bold text-center focus:outline-none focus:ring-2 focus:ring-green-500 border-2 border-gray-300">
                    </div>
                    <div id="withdrawal-error" class="hidden mt-2 text-red-600 text-sm font-medium"></div>
                </div>
                
                <div id="withdrawal-status" class="mb-6">
                    <div id="insufficient-funds" class="bg-red-50 border border-red-200 p-4 rounded-xl text-red-700 hidden">
                        <div class="flex items-center justify-center mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="font-bold">Insufficient Balance</span>
                        </div>
                        <p>You need at least ₹100.00 to make a withdrawal. Keep playing to earn more!</p>
                    </div>
                    
                    <div id="withdrawal-available" class="bg-green-50 border border-green-200 p-4 rounded-xl text-green-700 hidden">
                        <div class="flex items-center justify-center mb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="font-bold">Withdrawal Available</span>
                        </div>
                        <p>Enter the amount you want to withdraw!</p>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <button id="proceed-withdrawal-button" class="menu-button bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Proceed to Payment
                </button>
                <button id="back-from-withdrawal" class="menu-button bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-full w-full">
                    Back
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Details Menu -->
    <div id="payment-details-menu" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Payment Details</h2>
            
            <!-- Withdrawal Summary -->
            <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-xl mb-6">
                <div class="text-center">
                    <div class="text-lg text-gray-700 mb-1">Withdrawal Amount</div>
                    <div class="text-3xl font-bold text-blue-600" id="withdrawal-summary-amount">₹0.00</div>
                </div>
            </div>
            
            <!-- Payment Method Selection -->
            <div class="mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">Choose Payment Method</h3>
                
                <div class="space-y-3">
                    <!-- UPI Option -->
                    <div class="payment-method-option border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all duration-300 shadow-sm" data-method="upi">
                        <div class="flex items-center">
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 p-3 rounded-full mr-4 shadow-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                </svg>
                            </div>
                            <div class="flex-grow">
                                <h4 class="font-bold text-lg text-gray-800">UPI Payment</h4>
                                <p class="text-gray-600 text-sm font-medium">Quick & secure UPI transfer</p>
                            </div>
                            <div class="payment-method-radio w-6 h-6 border-2 border-gray-400 rounded-full bg-white shadow-inner transition-all duration-200"></div>
                        </div>
                    </div>
                    
                    <!-- Bank Transfer Option -->
                    <div class="payment-method-option border-2 border-gray-200 rounded-xl p-4 cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all duration-300 shadow-sm" data-method="bank">
                        <div class="flex items-center">
                            <div class="bg-gradient-to-r from-green-500 to-teal-500 p-3 rounded-full mr-4 shadow-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                </svg>
                            </div>
                            <div class="flex-grow">
                                <h4 class="font-bold text-lg text-gray-800">Bank Transfer</h4>
                                <p class="text-gray-600 text-sm font-medium">Direct bank account transfer</p>
                            </div>
                            <div class="payment-method-radio w-6 h-6 border-2 border-gray-400 rounded-full bg-white shadow-inner transition-all duration-200"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- UPI Details Form -->
            <div id="upi-details" class="hidden mb-6">
                <h4 class="font-bold text-lg mb-4 text-gray-800">UPI Details</h4>
                
                <!-- Saved UPI Accounts -->
                <div id="saved-upi-accounts" class="mb-4">
                    <label class="block text-sm font-bold text-purple-800 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                        </svg>
                        Saved UPI Accounts
                    </label>
                    <select id="upi-account-select" class="w-full px-4 py-3 rounded-xl text-gray-800 text-lg font-medium focus:outline-none focus:ring-2 focus:ring-purple-500 border-2 border-purple-300 bg-gradient-to-r from-purple-50 to-white shadow-sm transition-all duration-200 hover:border-purple-400 mb-3">
                        <option value="">Select saved account or add new</option>
                    </select>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="upi-id" class="block text-sm font-medium text-gray-700 mb-2">UPI ID</label>
                        <input type="text" id="upi-id" placeholder="yourname@paytm / yourname@phonepe" class="w-full px-4 py-3 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-purple-500 border border-gray-300">
                    </div>
                    <div>
                        <label for="upi-name" class="block text-sm font-medium text-gray-700 mb-2">Account Holder Name</label>
                        <input type="text" id="upi-name" placeholder="Full Name as per UPI" class="w-full px-4 py-3 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-purple-500 border border-gray-300">
                    </div>
                    
                    <!-- Save Account Checkbox -->
                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 border-2 border-purple-300 rounded-xl p-4 shadow-sm">
                        <div class="flex items-center space-x-3">
                            <div class="relative">
                                <input type="checkbox" id="save-upi-account" class="w-6 h-6 text-purple-600 bg-white border-2 border-purple-400 rounded-lg focus:ring-purple-500 focus:ring-2 cursor-pointer transition-all duration-200">
                                <div class="absolute inset-0 pointer-events-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white opacity-0 transition-opacity duration-200" style="margin: 4px;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                            </div>
                            <label for="save-upi-account" class="text-sm font-bold text-purple-800 cursor-pointer flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                                </svg>
                                Save this UPI account for future withdrawals
                            </label>
                        </div>
                        <p class="text-xs text-purple-700 mt-2 ml-9 font-medium">You can save up to 5 UPI accounts for quick access</p>
                    </div>
                </div>
            </div>
            
            <!-- Bank Details Form -->
            <div id="bank-details" class="hidden mb-6">
                <h4 class="font-bold text-lg mb-4 text-gray-800">Bank Account Details</h4>
                
                <!-- Saved Bank Accounts -->
                <div id="saved-bank-accounts" class="mb-4">
                    <label class="block text-sm font-bold text-green-800 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                        Saved Bank Accounts
                    </label>
                    <select id="bank-account-select" class="w-full px-4 py-3 rounded-xl text-gray-800 text-lg font-medium focus:outline-none focus:ring-2 focus:ring-green-500 border-2 border-green-300 bg-gradient-to-r from-green-50 to-white shadow-sm transition-all duration-200 hover:border-green-400 mb-3">
                        <option value="">Select saved account or add new</option>
                    </select>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label for="account-number" class="block text-sm font-medium text-gray-700 mb-2">Account Number</label>
                        <input type="text" id="account-number" placeholder="Enter your account number" class="w-full px-4 py-3 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-green-500 border border-gray-300">
                    </div>
                    <div>
                        <label for="ifsc-code" class="block text-sm font-medium text-gray-700 mb-2">IFSC Code</label>
                        <input type="text" id="ifsc-code" placeholder="ABCD0123456" class="w-full px-4 py-3 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-green-500 border border-gray-300">
                    </div>
                    <div>
                        <label for="account-holder-name" class="block text-sm font-medium text-gray-700 mb-2">Account Holder Name</label>
                        <input type="text" id="account-holder-name" placeholder="Full Name as per bank account" class="w-full px-4 py-3 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-green-500 border border-gray-300">
                    </div>
                    <div>
                        <label for="bank-name" class="block text-sm font-medium text-gray-700 mb-2">Bank Name</label>
                        <input type="text" id="bank-name" placeholder="State Bank of India" class="w-full px-4 py-3 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-green-500 border border-gray-300">
                    </div>
                    
                    <!-- Save Account Checkbox -->
                    <div class="bg-gradient-to-r from-green-50 to-green-100 border-2 border-green-300 rounded-xl p-4 shadow-sm">
                        <div class="flex items-center space-x-3">
                            <div class="relative">
                                <input type="checkbox" id="save-bank-account" class="w-6 h-6 text-green-600 bg-white border-2 border-green-400 rounded-lg focus:ring-green-500 focus:ring-2 cursor-pointer transition-all duration-200">
                                <div class="absolute inset-0 pointer-events-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white opacity-0 transition-opacity duration-200" style="margin: 4px;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                            </div>
                            <label for="save-bank-account" class="text-sm font-bold text-green-800 cursor-pointer flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                </svg>
                                Save this bank account for future withdrawals
                            </label>
                        </div>
                        <p class="text-xs text-green-700 mt-2 ml-9 font-medium">You can save up to 5 bank accounts for quick access</p>
                    </div>
                </div>
            </div>
            
            <!-- Error Message -->
            <div id="payment-error" class="hidden mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-full text-center"></div>
            
            <div class="space-y-3">
                <button id="confirm-withdrawal-button" class="menu-button bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Confirm Withdrawal
                </button>
                <button id="back-from-payment-details" class="menu-button bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-full w-full">
                    Back
                </button>
            </div>
        </div>
    </div>

    <!-- Profile Menu -->
    <div id="profile-menu" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Profile</h2>
            
            <!-- Profile Info -->
            <div class="space-y-4 mb-6">
                <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-xl">
                    <div class="text-sm text-gray-600 mb-1">Username</div>
                    <div class="text-lg font-bold" id="profile-username">@username</div>
                </div>
                
                <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-xl">
                    <div class="text-sm text-gray-600 mb-1">Email</div>
                    <div class="text-lg font-bold" id="profile-email">user@email.com</div>
                </div>
                
                <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-xl">
                    <div class="text-sm text-gray-600 mb-1">Member Since</div>
                    <div class="text-lg font-bold" id="profile-member-since">January 2024</div>
                </div>
                
                <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 p-4 rounded-xl">
                    <div class="text-sm text-gray-600 mb-1">Total Games Played</div>
                    <div class="text-lg font-bold" id="profile-games-played">0</div>
                </div>
                
                <div class="bg-gradient-to-r from-orange-50 to-orange-100 p-4 rounded-xl">
                    <div class="text-sm text-gray-600 mb-1">Total Withdrawals</div>
                    <div class="text-lg font-bold" id="profile-total-withdrawals">₹0.00 (0 times)</div>
                </div>
            </div>
            
            <div class="space-y-3">
                <button id="change-password-button" class="menu-button bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-6 rounded-full w-full text-lg">
                    Change Password
                </button>
                <button id="contact-support-button" class="menu-button bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-full w-full text-lg">
                    Contact Support
                </button>
                <button id="profile-logout-button" class="menu-button bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-3 px-6 rounded-full w-full text-lg">
                    Logout
                </button>
                <button id="back-from-profile" class="menu-button bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-full w-full">
                    Back
                </button>
            </div>
        </div>
    </div>

    <!-- Change Password Menu -->
    <div id="change-password-menu" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Change Password</h2>
            
            <div class="space-y-4 mb-6">
                <div class="relative">
                    <input type="password" id="current-password" placeholder="Current Password" class="w-full px-4 py-3 pr-12 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 border border-gray-300">
                    <button type="button" id="toggle-current-password" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-gray-800 focus:outline-none">
                        <svg id="current-eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                        </svg>
                        <svg id="current-eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                    </button>
                </div>
                <div class="relative">
                    <input type="password" id="new-password" placeholder="New Password (min 6 characters)" class="w-full px-4 py-3 pr-12 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 border border-gray-300">
                    <button type="button" id="toggle-new-password" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-gray-800 focus:outline-none">
                        <svg id="new-eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                        </svg>
                        <svg id="new-eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                    </button>
                </div>
                <div class="relative">
                    <input type="password" id="confirm-new-password" placeholder="Confirm New Password" class="w-full px-4 py-3 pr-12 rounded-full text-gray-800 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 border border-gray-300">
                    <button type="button" id="toggle-confirm-new-password" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-gray-800 focus:outline-none">
                        <svg id="confirm-new-eye-closed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                        </svg>
                        <svg id="confirm-new-eye-open" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Error Message -->
            <div id="password-error" class="hidden mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-full text-center"></div>
            
            <!-- Success Message -->
            <div id="password-success" class="hidden mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-full text-center"></div>
            
            <div class="space-y-3">
                <button id="update-password-button" class="menu-button bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-full w-full text-lg">
                    Update Password
                </button>
                <button id="back-from-change-password" class="menu-button bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-full w-full">
                    Back
                </button>
            </div>
        </div>
    </div>

    <!-- Withdrawal History Menu -->
    <div id="withdrawal-history-menu" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="text-center mb-6">
                <div class="flex items-center justify-center mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                    </svg>
                    <h2 class="text-3xl font-bold text-gray-800">Withdrawal History</h2>
                </div>
            </div>
            
            <!-- Summary Stats -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-xl text-center">
                    <div class="text-sm text-gray-600 mb-1">Total Withdrawn</div>
                    <div class="text-xl font-bold text-green-600" id="history-total-withdrawn">₹0.00</div>
                </div>
                <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-xl text-center">
                    <div class="text-sm text-gray-600 mb-1">Total Requests</div>
                    <div class="text-xl font-bold text-blue-600" id="history-total-requests">0</div>
                </div>
            </div>
            
            <!-- Withdrawal List -->
            <div id="withdrawal-history-container" class="space-y-4 mb-6 max-h-96 overflow-y-auto">
                <div class="text-center text-gray-500 py-8" id="no-withdrawal-history-message">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                    </svg>
                    <p class="text-lg">No withdrawals yet.</p>
                    <p>Your withdrawal history will appear here.</p>
                </div>
            </div>
            
            <div class="text-center">
                <button id="back-from-withdrawal-history" class="menu-button bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-8 rounded-full text-lg">
                    Back
                </button>
            </div>
        </div>
    </div>

    <!-- Pause Menu -->
    <div id="pause-menu" class="fixed inset-0 flex items-center justify-center z-50 hidden modal">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4">
            <h2 class="text-4xl font-bold text-center mb-6 text-gray-800">Game Paused</h2>
            
            <div class="space-y-4 mb-8">
                <button id="resume-button" class="menu-button bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                    Resume Game
                </button>
                <button id="restart-button" class="menu-button bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                    Restart Game
                </button>
                <button id="exit-to-menu-button" class="menu-button bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 px-8 rounded-full w-full text-xl">
                    Exit to Menu
                </button>
            </div>
            
            <div class="text-center text-gray-600 text-lg">
                <p>Current Earnings: <span id="pause-current-earnings" class="font-bold">₹0.00</span></p>
            </div>
        </div>
    </div>

    <!-- Withdrawal Success Modal -->
    <div id="withdrawal-success-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4 text-white border-4 border-white/20">
            <div class="text-center">
                <!-- Success Animation -->
                <div class="mb-6">
                    <div class="w-24 h-24 mx-auto bg-white/20 rounded-full flex items-center justify-center mb-4 animate-pulse">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                </div>
                
                <h2 class="text-3xl font-bold mb-4">🎉 Withdrawal Successful!</h2>
                
                <div class="bg-white/20 rounded-xl p-4 mb-6">
                    <div class="text-lg mb-2">Amount Withdrawn</div>
                    <div class="text-4xl font-bold" id="success-withdrawal-amount">₹0.00</div>
                </div>
                
                <div class="bg-white/10 rounded-xl p-4 mb-6">
                    <div class="text-sm opacity-90 mb-2">Payment Method</div>
                    <div class="text-lg font-bold" id="success-payment-method">UPI</div>
                    <div class="text-sm opacity-75 mt-1" id="success-payment-details">yourname@paytm</div>
                </div>
                
                <div class="text-center mb-6">
                    <p class="text-lg mb-2">💰 Money will be transferred to your account within</p>
                    <p class="text-2xl font-bold text-yellow-300">24 Hours</p>
                </div>
                
                <div class="bg-yellow-400/20 border border-yellow-300/30 rounded-xl p-3 mb-6">
                    <p class="text-sm">
                        <span class="font-bold">📋 Reference ID:</span> 
                        <span id="success-reference-id" class="font-mono">WD123456789</span>
                    </p>
                </div>
                
                <button id="close-success-modal" class="bg-white text-green-600 font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-100 transition-all duration-300 transform hover:scale-105">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <!-- Blocked Account Modal -->
    <div id="blocked-account-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="bg-gradient-to-br from-red-500 to-red-700 p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4 text-white border-4 border-white/20">
            <div class="text-center">
                <!-- Block Icon -->
                <div class="mb-6">
                    <div class="w-24 h-24 mx-auto bg-white/20 rounded-full flex items-center justify-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728" />
                        </svg>
                    </div>
                </div>
                
                <h2 class="text-3xl font-bold mb-4">🚫 Account Blocked</h2>
                
                <div class="bg-white/20 rounded-xl p-4 mb-6">
                    <div class="text-lg mb-2">Reason</div>
                    <div class="text-lg font-bold" id="block-reason">Suspicious activity detected</div>
                </div>
                
                <div class="text-center mb-6">
                    <p class="text-lg mb-2">Your account has been temporarily blocked due to suspicious activity.</p>
                    <p class="text-sm opacity-90">If you believe this is a mistake, please contact our support team.</p>
                </div>
                
                <div class="space-y-3">
                    <button id="contact-support-blocked" class="bg-white text-red-600 font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-100 transition-all duration-300 transform hover:scale-105 w-full">
                        Contact Support
                    </button>
                    <button id="close-blocked-modal" class="bg-red-800 hover:bg-red-900 text-white font-bold py-3 px-8 rounded-full text-lg transition-all duration-300 w-full">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Support Modal -->
    <div id="contact-support-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">📞 Contact Support</h2>
            
            <div class="space-y-4 mb-6">
                <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-xl">
                    <div class="flex items-center mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <h3 class="text-lg font-bold text-gray-800">Email Support</h3>
                    </div>
                    <p class="text-gray-700 mb-2">Send us an email for detailed assistance</p>
                    <a href="mailto:support@flappyearn.com" class="text-blue-600 font-bold hover:underline">support@flappyearn.com</a>
                </div>
                
                <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-xl">
                    <div class="flex items-center mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                        </svg>
                        <h3 class="text-lg font-bold text-gray-800">WhatsApp Support</h3>
                    </div>
                    <p class="text-gray-700 mb-2">Quick support via WhatsApp</p>
                    <a href="https://wa.me/919876543210" target="_blank" class="text-green-600 font-bold hover:underline">+91 98765 43210</a>
                </div>
                
                <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-xl">
                    <div class="flex items-center mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h3 class="text-lg font-bold text-gray-800">Support Hours</h3>
                    </div>
                    <p class="text-gray-700">Monday - Friday: 9:00 AM - 6:00 PM IST</p>
                    <p class="text-gray-700">Saturday - Sunday: 10:00 AM - 4:00 PM IST</p>
                </div>
                
                <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 p-4 rounded-xl">
                    <div class="flex items-center mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h3 class="text-lg font-bold text-gray-800">Common Issues</h3>
                    </div>
                    <ul class="text-gray-700 text-sm space-y-1">
                        <li>• Account blocked or suspended</li>
                        <li>• Withdrawal not received</li>
                        <li>• Game earnings not credited</li>
                        <li>• Password reset issues</li>
                        <li>• Technical problems</li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center">
                <button id="close-contact-support" class="menu-button bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-3 px-8 rounded-full text-lg">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Game variables
        let gameActive = false;
        let gameLoop;
        let bird;
        let pipes = [];
        let clouds = [];
        let money = 0;
        let difficulty = 'normal';
        let gravity = 0.5;
        let jumpStrength = -8;
        let pipeSpeed = 3;
        let pipeGap = 180;
        let pipeFrequency = 1500;
        let lastPipeTime = 0;
        let gameWidth;
        let gameHeight;
        let groundHeight = 90;
        let gameStartTime;
        let gameHistory = [];
        let highScores = {
            easy: [0, 0, 0],
            normal: [0, 0, 0],
            hard: [0, 0, 0]
        };
        let countdownActive = false;
        let totalBalance = 0;
        let currentUser = null;
        let totalWithdrawals = 0;
        let withdrawalCount = 0;
        let selectedDifficulty = 'normal';
        let gameSession = null; // Track current game session
        let withdrawalHistory = []; // Track withdrawal history with status
        let savedPaymentAccounts = {
            upi: [], // Max 5 UPI accounts
            bank: [] // Max 5 Bank accounts
        };
        
        // Power-ups state
        let activePowerUps = {
            doubleReward: false,
            coinCollector: false,
            shield: false
        };
        let powerUpTimers = {
            doubleReward: 0,
            coinCollector: 0,
            shield: 0
        };
        let shieldUsesLeft = 0;
        let coins = [];
        
        // Power-up inventory - separate for each difficulty
        let powerUpInventory = {
            easy: {
                doubleReward: 0,
                coinCollector: 0,
                shield: 0
            },
            normal: {
                doubleReward: 0,
                coinCollector: 0,
                shield: 0
            },
            hard: {
                doubleReward: 0,
                coinCollector: 0,
                shield: 0
            }
        };
        
        // Money values per pipe based on difficulty
        const moneyValues = {
            easy: 0.05,
            normal: 0.10,
            hard: 0.20
        };
        
        // Power-up prices based on difficulty
        const powerUpPrices = {
            easy: 1,
            normal: 2,
            hard: 3
        };
        
        // Coin values based on difficulty
        const coinValues = {
            easy: 0.01,
            normal: 0.02,
            hard: 0.03
        };
        
        // Firebase Authentication Functions
        async function checkUsernameExists(username) {
            try {
                // Simple client-side check - in production, this would be done server-side
                // For now, we'll just check if the username is reasonable
                if (username.length < 3 || username.length > 20) {
                    return true; // Consider invalid usernames as "taken"
                }
                return false; // Allow all valid usernames for demo
            } catch (error) {
                console.error('Error checking username:', error);
                return false;
            }
        }
        
        async function registerUser(email, password, username) {
            try {
                // Check if username already exists
                const usernameExists = await checkUsernameExists(username);
                if (usernameExists) {
                    return { success: false, error: 'Username already taken. Please choose a different username.' };
                }
                
                const { createUserWithEmailAndPassword } = window.firebaseAuthMethods;
                const userCredential = await createUserWithEmailAndPassword(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                // Store username locally for demo (in production, this would be in Firestore)
                localStorage.setItem('flappyBirdUsername_' + user.uid, username);
                localStorage.setItem('flappyBirdUserData_' + user.uid, JSON.stringify({
                    username: username,
                    email: user.email,
                    totalBalance: 0,
                    totalWithdrawals: 0,
                    withdrawalCount: 0,
                    highScores: {
                        easy: [0, 0, 0],
                        normal: [0, 0, 0],
                        hard: [0, 0, 0]
                    },
                    gameHistory: [],
                    withdrawalHistory: [],
                    savedPaymentAccounts: {
                        upi: [],
                        bank: []
                    },
                    createdAt: new Date()
                }));
                
                return { success: true, user };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function loginUser(email, password) {
            try {
                const { signInWithEmailAndPassword } = window.firebaseAuthMethods;
                const userCredential = await signInWithEmailAndPassword(window.firebaseAuth, email, password);
                return { success: true, user: userCredential.user };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function logoutUser() {
            try {
                const { signOut } = window.firebaseAuthMethods;
                await signOut(window.firebaseAuth);
                return { success: true };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        // Load user data from Firestore
        async function loadUserData(userId) {
            try {
                // Check if Firebase methods are available
                if (!window.firebaseDbMethods || !window.firebaseDb) {
                    console.warn('Firebase not available, loading from localStorage only');
                    loadUserDataFromLocalStorage(userId);
                    return;
                }
                
                const { doc, getDoc } = window.firebaseDbMethods;
                const userDocRef = doc(window.firebaseDb, 'users', userId);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    const data = userDoc.data();
                    currentUser.username = data.username || 'User';
                    currentUser.createdAt = data.createdAt ? data.createdAt.toDate() : new Date();
                    currentUser.isBlocked = data.isBlocked || false;
                    currentUser.suspiciousActivity = data.suspiciousActivity || 0;
                    totalBalance = data.totalBalance || 0;
                    totalWithdrawals = data.totalWithdrawals || 0;
                    withdrawalCount = data.withdrawalCount || 0;
                    highScores = data.highScores || {
                        easy: [0, 0, 0],
                        normal: [0, 0, 0],
                        hard: [0, 0, 0]
                    };
                    gameHistory = data.gameHistory || [];
                    withdrawalHistory = data.withdrawalHistory || [];
                    savedPaymentAccounts = data.savedPaymentAccounts || {
                        upi: [],
                        bank: []
                    };
                    powerUpInventory = data.powerUpInventory || {
                        easy: {
                            doubleReward: 0,
                            coinCollector: 0,
                            shield: 0
                        },
                        normal: {
                            doubleReward: 0,
                            coinCollector: 0,
                            shield: 0
                        },
                        hard: {
                            doubleReward: 0,
                            coinCollector: 0,
                            shield: 0
                        }
                    };
                    
                    // Check if user is blocked
                    if (currentUser.isBlocked) {
                        showBlockedAccountModal(data.blockReason || 'Suspicious activity detected');
                        return;
                    }
                } else {
                    // Create new user document
                    await createUserDocument(userId);
                }
                
                // Log user login activity
                await logUserActivity('login', {
                    timestamp: new Date(),
                    ip: await getUserIP(),
                    userAgent: navigator.userAgent
                });
                
                // Update displays
                updateHighScoresDisplay();
                updateGameHistoryDisplay();
                updateWithdrawalDisplay();
                updateUserDisplay();
                updateProfileDisplay();
            } catch (error) {
                console.error('Error loading user data:', error);
                // Fallback to localStorage
                loadUserDataFromLocalStorage(userId);
            }
        }
        
        // Create new user document in Firestore
        async function createUserDocument(userId) {
            try {
                const { doc, setDoc } = window.firebaseDbMethods;
                
                // Get username from localStorage if available
                const savedUsername = localStorage.getItem('flappyBirdUsername_' + userId);
                
                const userData = {
                    username: savedUsername || currentUser.username || 'User',
                    email: currentUser.email,
                    createdAt: new Date(),
                    totalBalance: 0,
                    totalWithdrawals: 0,
                    withdrawalCount: 0,
                    isBlocked: false,
                    suspiciousActivity: 0,
                    highScores: {
                        easy: [0, 0, 0],
                        normal: [0, 0, 0],
                        hard: [0, 0, 0]
                    },
                    gameHistory: [],
                    withdrawalHistory: [],
                    savedPaymentAccounts: {
                        upi: [],
                        bank: []
                    },
                    powerUpInventory: {
                        easy: {
                            doubleReward: 0,
                            coinCollector: 0,
                            shield: 0
                        },
                        normal: {
                            doubleReward: 0,
                            coinCollector: 0,
                            shield: 0
                        },
                        hard: {
                            doubleReward: 0,
                            coinCollector: 0,
                            shield: 0
                        }
                    },
                    lastActivity: new Date(),
                    totalGamesPlayed: 0,
                    totalPlayTime: 0
                };
                
                await setDoc(doc(window.firebaseDb, 'users', userId), userData);
                
                // Set local variables
                currentUser.username = userData.username;
                currentUser.createdAt = userData.createdAt;
                currentUser.isBlocked = userData.isBlocked;
                currentUser.suspiciousActivity = userData.suspiciousActivity;
                totalBalance = userData.totalBalance;
                totalWithdrawals = userData.totalWithdrawals;
                withdrawalCount = userData.withdrawalCount;
                highScores = userData.highScores;
                gameHistory = userData.gameHistory;
                withdrawalHistory = userData.withdrawalHistory || [];
                savedPaymentAccounts = userData.savedPaymentAccounts || {
                    upi: [],
                    bank: []
                };
                powerUpInventory = userData.powerUpInventory;
            } catch (error) {
                console.error('Error creating user document:', error);
            }
        }
        
        // Fallback to localStorage
        function loadUserDataFromLocalStorage(userId) {
            const userData = localStorage.getItem('flappyBirdUserData_' + userId);
            
            if (userData) {
                const data = JSON.parse(userData);
                currentUser.username = data.username || 'User';
                currentUser.createdAt = new Date(data.createdAt);
                totalBalance = data.totalBalance || 0;
                totalWithdrawals = data.totalWithdrawals || 0;
                withdrawalCount = data.withdrawalCount || 0;
                highScores = data.highScores || {
                    easy: [0, 0, 0],
                    normal: [0, 0, 0],
                    hard: [0, 0, 0]
                };
                gameHistory = data.gameHistory || [];
                withdrawalHistory = data.withdrawalHistory || [];
                savedPaymentAccounts = data.savedPaymentAccounts || {
                    upi: [],
                    bank: []
                };
                powerUpInventory = data.powerUpInventory || {
                    easy: {
                        doubleReward: 0,
                        coinCollector: 0,
                        shield: 0
                    },
                    normal: {
                        doubleReward: 0,
                        coinCollector: 0,
                        shield: 0
                    },
                    hard: {
                        doubleReward: 0,
                        coinCollector: 0,
                        shield: 0
                    }
                };
            }
        }
        
        // Save user data to Firestore with anti-cheat validation
        async function saveUserData() {
            if (!currentUser) return;
            
            try {
                // Check if Firebase methods are available
                if (!window.firebaseDbMethods || !window.firebaseDb) {
                    console.warn('Firebase not available, saving to localStorage only');
                    saveToLocalStorageOnly();
                    return;
                }
                
                const { doc, updateDoc, serverTimestamp } = window.firebaseDbMethods;
                
                // Anti-cheat validation
                const isValidData = await validateUserData();
                if (!isValidData) {
                    await flagSuspiciousActivity('Invalid game data detected');
                    return;
                }
                
                const userData = {
                    username: currentUser.username,
                    email: currentUser.email,
                    totalBalance: totalBalance,
                    totalWithdrawals: totalWithdrawals,
                    withdrawalCount: withdrawalCount,
                    highScores: highScores,
                    gameHistory: gameHistory,
                    withdrawalHistory: withdrawalHistory,
                    savedPaymentAccounts: savedPaymentAccounts,
                    powerUpInventory: powerUpInventory,
                    lastActivity: new Date(),
                    totalGamesPlayed: gameHistory.length,
                    totalPlayTime: calculateTotalPlayTime()
                };
                
                const userDocRef = doc(window.firebaseDb, 'users', currentUser.uid);
                await updateDoc(userDocRef, userData);
                
                // Also save to localStorage as backup
                localStorage.setItem('flappyBirdUserData_' + currentUser.uid, JSON.stringify(userData));
            } catch (error) {
                console.error('Error saving user data:', error);
                // Fallback to localStorage
                saveToLocalStorageOnly();
            }
        }
        
        // Fallback save function
        function saveToLocalStorageOnly() {
            const userData = {
                username: currentUser.username,
                email: currentUser.email,
                totalBalance: totalBalance,
                totalWithdrawals: totalWithdrawals,
                withdrawalCount: withdrawalCount,
                highScores: highScores,
                gameHistory: gameHistory,
                withdrawalHistory: withdrawalHistory,
                savedPaymentAccounts: savedPaymentAccounts,
                powerUpInventory: powerUpInventory,
                createdAt: currentUser.createdAt,
                lastUpdated: new Date()
            };
            localStorage.setItem('flappyBirdUserData_' + currentUser.uid, JSON.stringify(userData));
        }
        
        // Anti-cheat validation system - More lenient and focused on extreme cheating
        async function validateUserData() {
            try {
                // Only check for extreme impossible earnings (10x more than possible)
                for (let game of gameHistory) {
                    const maxPossibleForGame = calculateMaxPossibleEarningForGame(game.difficulty, game.duration);
                    
                    // Only flag if earning is 10 times more than maximum possible
                    if (game.money > maxPossibleForGame * 10) {
                        console.warn('Extreme impossible earning detected:', {
                            earned: game.money,
                            maxPossible: maxPossibleForGame,
                            difficulty: game.difficulty,
                            duration: game.duration
                        });
                        return false;
                    }
                }
                
                // Check for extremely suspicious patterns - very short games with massive earnings
                for (let game of gameHistory) {
                    // Only flag if game is less than 5 seconds but earned more than ₹10
                    if (game.duration < 5 && game.money > 10) {
                        console.warn('Extremely suspicious short game:', game);
                        return false;
                    }
                }
                
                // Check for impossible earning rates - much more lenient
                const recentGames = gameHistory.slice(0, 10); // Last 10 games
                if (recentGames.length >= 5) {
                    const totalRecentEarnings = recentGames.reduce((sum, game) => sum + game.money, 0);
                    const totalRecentTime = recentGames.reduce((sum, game) => sum + game.duration, 0);
                    
                    if (totalRecentTime > 0) {
                        const earningRate = totalRecentEarnings / (totalRecentTime / 60); // Earnings per minute
                        const maxReasonableRate = 50; // Much higher threshold - ₹50 per minute
                        
                        if (earningRate > maxReasonableRate) {
                            console.warn('Extremely high earning rate detected:', {
                                rate: earningRate,
                                maxReasonable: maxReasonableRate,
                                recentEarnings: totalRecentEarnings,
                                recentTime: totalRecentTime
                            });
                            return false;
                        }
                    }
                }
                
                return true;
            } catch (error) {
                console.error('Error in validation:', error);
                return true; // Allow if validation fails
            }
        }
        
        // Calculate maximum possible earning for a specific game
        function calculateMaxPossibleEarningForGame(difficulty, duration) {
            // Base earning per pipe for each difficulty
            const baseEarnings = {
                easy: 0.05,
                normal: 0.10,
                hard: 0.20
            };
            
            // Minimum time between pipes (in seconds)
            const minPipeInterval = {
                easy: 1.8, // 1800ms
                normal: 1.5, // 1500ms  
                hard: 1.2   // 1200ms
            };
            
            // Calculate maximum possible pipes in given duration
            const maxPipes = Math.floor(duration / minPipeInterval[difficulty]);
            
            // Base earning from pipes
            let maxEarning = maxPipes * baseEarnings[difficulty];
            
            // Account for double reward power-up (can double earnings)
            maxEarning *= 2;
            
            // Account for coin collector (adds extra coins)
            const coinValue = {
                easy: 0.01,
                normal: 0.02,
                hard: 0.03
            };
            
            // Assume maximum 3 coins per pipe with coin collector
            const maxCoins = maxPipes * 3;
            maxEarning += maxCoins * coinValue[difficulty];
            
            // Add 20% buffer for calculation variations
            maxEarning *= 1.2;
            
            return maxEarning;
        }
        
        // Calculate total play time from game history
        function calculateTotalPlayTime() {
            return gameHistory.reduce((total, game) => total + (game.duration || 0), 0);
        }
        
        // Flag suspicious activity
        async function flagSuspiciousActivity(reason) {
            try {
                if (!currentUser) return;
                
                currentUser.suspiciousActivity = (currentUser.suspiciousActivity || 0) + 1;
                
                // Log the suspicious activity
                await logUserActivity('suspicious_activity', {
                    reason: reason,
                    timestamp: new Date(),
                    userAgent: navigator.userAgent,
                    totalBalance: totalBalance,
                    gameHistory: gameHistory.slice(0, 5) // Last 5 games
                });
                
                // Block user only after many suspicious activities (much higher threshold)
                if (currentUser.suspiciousActivity >= 20) {
                    await blockUser(reason);
                }
                
                // Update user document
                const { doc, updateDoc } = window.firebaseDbMethods;
                const userDocRef = doc(window.firebaseDb, 'users', currentUser.uid);
                await updateDoc(userDocRef, {
                    suspiciousActivity: currentUser.suspiciousActivity,
                    lastSuspiciousActivity: new Date(),
                    lastSuspiciousReason: reason
                });
                
            } catch (error) {
                console.error('Error flagging suspicious activity:', error);
            }
        }
        
        // Block user account
        async function blockUser(reason) {
            try {
                if (!currentUser) return;
                
                currentUser.isBlocked = true;
                
                // Update user document
                const { doc, updateDoc } = window.firebaseDbMethods;
                const userDocRef = doc(window.firebaseDb, 'users', currentUser.uid);
                await updateDoc(userDocRef, {
                    isBlocked: true,
                    blockedAt: new Date(),
                    blockReason: reason,
                    totalBalance: 0 // Reset balance for blocked users
                });
                
                // Log the blocking
                await logUserActivity('account_blocked', {
                    reason: reason,
                    timestamp: new Date(),
                    suspiciousActivityCount: currentUser.suspiciousActivity
                });
                
                // Show custom block modal instead of alert
                showBlockedAccountModal(reason);
                
            } catch (error) {
                console.error('Error blocking user:', error);
            }
        }
        
        // Log user activity
        async function logUserActivity(activityType, data) {
            try {
                if (!currentUser) return;
                
                // Check if Firebase methods are available
                if (!window.firebaseDbMethods || !window.firebaseDb) {
                    console.warn('Firebase not available, skipping activity log');
                    return;
                }
                
                const { collection, addDoc } = window.firebaseDbMethods;
                
                const activityData = {
                    userId: currentUser.uid,
                    email: currentUser.email,
                    username: currentUser.username,
                    activityType: activityType,
                    timestamp: new Date(),
                    ...data
                };
                
                await addDoc(collection(window.firebaseDb, 'userActivities'), activityData);
                
            } catch (error) {
                console.error('Error logging user activity:', error);
                // Continue without logging - don't break the game
            }
        }
        
        // Get user IP address (for tracking)
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }
        
        // Update user display
        function updateUserDisplay() {
            if (currentUser) {
                document.getElementById('user-username').textContent = '@' + (currentUser.username || 'User');
                document.getElementById('user-email').textContent = currentUser.email;
                document.getElementById('user-balance').textContent = formatMoney(totalBalance);
            }
        }
        
        // Update profile display
        function updateProfileDisplay() {
            if (currentUser) {
                document.getElementById('profile-username').textContent = '@' + (currentUser.username || 'User');
                document.getElementById('profile-email').textContent = currentUser.email;
                
                // Format member since date
                if (currentUser.createdAt) {
                    const createdDate = currentUser.createdAt.toDate ? currentUser.createdAt.toDate() : new Date(currentUser.createdAt);
                    const options = { year: 'numeric', month: 'long' };
                    document.getElementById('profile-member-since').textContent = createdDate.toLocaleDateString('en-US', options);
                } else {
                    document.getElementById('profile-member-since').textContent = 'Unknown';
                }
                
                // Update games played - ensure it shows actual count
                const gamesPlayed = gameHistory ? gameHistory.length : 0;
                document.getElementById('profile-games-played').textContent = gamesPlayed.toString();
                
                // Update total withdrawals
                document.getElementById('profile-total-withdrawals').textContent = 
                    `${formatMoney(totalWithdrawals)} (${withdrawalCount} times)`;
            }
        }
        
        // Check if we have saved data in localStorage (fallback)
        function loadSavedData() {
            // This is now handled by Firebase, but kept for fallback
            if (!currentUser) {
                const savedHighScores = localStorage.getItem('flappyBirdHighScores');
                if (savedHighScores) {
                    highScores = JSON.parse(savedHighScores);
                }
                
                const savedGameHistory = localStorage.getItem('flappyBirdGameHistory');
                if (savedGameHistory) {
                    gameHistory = JSON.parse(savedGameHistory);
                }
                
                const savedTotalBalance = localStorage.getItem('flappyBirdTotalBalance');
                if (savedTotalBalance) {
                    totalBalance = parseFloat(savedTotalBalance);
                }
                
                // Update displays
                updateHighScoresDisplay();
                updateGameHistoryDisplay();
                updateWithdrawalDisplay();
                updateMoneyIndicator();
            }
        }
        
        // Save data (now saves to Firebase)
        function saveData() {
            if (currentUser) {
                saveUserData();
            } else {
                // Fallback to localStorage
                localStorage.setItem('flappyBirdHighScores', JSON.stringify(highScores));
                localStorage.setItem('flappyBirdGameHistory', JSON.stringify(gameHistory));
                localStorage.setItem('flappyBirdTotalBalance', totalBalance.toString());
            }
        }
        
        // Format money value to rupee format
        function formatMoney(value) {
            return '₹' + value.toFixed(2);
        }
        
        // DOM Elements
        const gameContainer = document.getElementById('game-container');
        const gameCanvas = document.getElementById('game-canvas');
        const ctx = gameCanvas.getContext('2d');
        const birdElement = document.getElementById('bird');
        const groundElement = document.getElementById('ground');

        const countdownOverlay = document.getElementById('countdown-overlay');
        const countdownNumber = document.getElementById('countdown-number');
        const screenFlash = document.getElementById('screen-flash');
        
        // Menus
        const mainMenu = document.getElementById('main-menu');
        const difficultyMenu = document.getElementById('difficulty-menu');
        const howToPlayMenu = document.getElementById('how-to-play');
        const highScoresMenu = document.getElementById('high-scores');
        const gameHistoryMenu = document.getElementById('game-history');
        const withdrawalMenu = document.getElementById('withdrawal-menu');
        const gameOverMenu = document.getElementById('game-over');
        const pauseMenu = document.getElementById('pause-menu');
        
        // Initialize the game
        function initGame() {
            // Set canvas size
            resizeGame();
            window.addEventListener('resize', resizeGame);
            
            // Set up event listeners
            setupEventListeners();
            
            // Set up Firebase auth state listener
            setupAuthStateListener();
            
            // Show auth screen initially
            showAuthScreen();
        }
        
        // Set up Firebase auth state listener
        function setupAuthStateListener() {
            const { onAuthStateChanged } = window.firebaseAuthMethods;
            onAuthStateChanged(window.firebaseAuth, async (user) => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    await loadUserData(user.uid);
                    showMainMenu();
                } else {
                    // User is signed out
                    currentUser = null;
                    totalBalance = 0;
                    highScores = {
                        easy: [0, 0, 0],
                        normal: [0, 0, 0],
                        hard: [0, 0, 0]
                    };
                    gameHistory = [];
                    showAuthScreen();
                }
            });
        }
        
        function resizeGame() {
            gameWidth = window.innerWidth;
            gameHeight = window.innerHeight;
            
            gameCanvas.width = gameWidth;
            gameCanvas.height = gameHeight;
            
            groundElement.style.width = gameWidth + 'px';
        }
        
        function setupEventListeners() {
            // Auth screen buttons
            document.getElementById('show-register').addEventListener('click', showRegisterForm);
            document.getElementById('show-login').addEventListener('click', showLoginForm);
            document.getElementById('login-button').addEventListener('click', handleLogin);
            document.getElementById('register-button').addEventListener('click', handleRegister);
            
            // Main menu buttons
            document.getElementById('play-button').addEventListener('click', showDifficultyMenu);
            document.getElementById('how-to-play-button').addEventListener('click', showHowToPlay);
            document.getElementById('high-scores-button').addEventListener('click', showHighScores);
            document.getElementById('withdrawal-button').addEventListener('click', showWithdrawal);
            document.getElementById('profile-button-main').addEventListener('click', showProfile);
            

            
            // Difficulty menu buttons
            document.getElementById('easy-button').addEventListener('click', () => startGameWithCountdown('easy'));
            document.getElementById('normal-button').addEventListener('click', () => startGameWithCountdown('normal'));
            document.getElementById('hard-button').addEventListener('click', () => startGameWithCountdown('hard'));
            document.getElementById('back-from-difficulty').addEventListener('click', showMainMenu);
            
            // How to play menu button
            document.getElementById('back-from-how-to').addEventListener('click', showMainMenu);
            
            // High scores menu buttons
            document.getElementById('back-from-high-scores').addEventListener('click', showMainMenu);
            document.getElementById('easy-scores-tab').addEventListener('click', () => switchScoresTab('easy'));
            document.getElementById('normal-scores-tab').addEventListener('click', () => switchScoresTab('normal'));
            document.getElementById('hard-scores-tab').addEventListener('click', () => switchScoresTab('hard'));
            
            // Game history menu button
            document.getElementById('back-from-game-history').addEventListener('click', showMainMenu);
            
            // Withdrawal menu buttons
            document.getElementById('back-from-withdrawal').addEventListener('click', showMainMenu);
            document.getElementById('proceed-withdrawal-button').addEventListener('click', proceedToPayment);
            document.getElementById('withdrawal-amount').addEventListener('input', validateWithdrawalAmount);
            
            // Withdrawal history button
            document.getElementById('withdrawal-history-button').addEventListener('click', showWithdrawalHistory);
            document.getElementById('back-from-withdrawal-history').addEventListener('click', showMainMenu);
            
            // Payment details menu buttons
            document.getElementById('back-from-payment-details').addEventListener('click', backToWithdrawal);
            document.getElementById('confirm-withdrawal-button').addEventListener('click', processWithdrawal);
            
            // Payment method selection
            document.querySelectorAll('.payment-method-option').forEach(option => {
                option.addEventListener('click', selectPaymentMethod);
            });
            
            // Saved account selection
            document.getElementById('upi-account-select').addEventListener('change', loadSavedUpiAccount);
            document.getElementById('bank-account-select').addEventListener('change', loadSavedBankAccount);
            
            // Game over menu buttons
            document.getElementById('play-again-button').addEventListener('click', () => {
                gameOverMenu.classList.add('hidden');
                clearGameElements();
                startCountdownAfterLoading(difficulty);
            });
            document.getElementById('main-menu-button').addEventListener('click', showMainMenu);
            
            // Profile menu buttons
            document.getElementById('back-from-profile').addEventListener('click', showMainMenu);
            document.getElementById('change-password-button').addEventListener('click', showChangePassword);
            document.getElementById('profile-logout-button').addEventListener('click', handleLogout);
            document.getElementById('contact-support-button').addEventListener('click', showContactSupport);
            
            // Change password menu buttons
            document.getElementById('back-from-change-password').addEventListener('click', backToProfile);
            document.getElementById('update-password-button').addEventListener('click', handlePasswordChange);
            
            // Shopping menu buttons
            document.getElementById('shopping-button').addEventListener('click', showShopping);
            document.getElementById('back-from-shopping').addEventListener('click', showMainMenu);
            
            // Shopping tab buttons
            document.getElementById('shop-easy-tab').addEventListener('click', () => switchShopTab('easy'));
            document.getElementById('shop-normal-tab').addEventListener('click', () => switchShopTab('normal'));
            document.getElementById('shop-hard-tab').addEventListener('click', () => switchShopTab('hard'));
            
            // Easy shop purchase buttons
            document.getElementById('shop-easy-double-reward-buy').addEventListener('click', () => buyPowerUpFromShop('doubleReward', 'easy'));
            document.getElementById('shop-easy-double-reward-ad').addEventListener('click', () => watchAdForPowerUpFromShop('doubleReward', 'easy'));
            document.getElementById('shop-easy-coin-collector-buy').addEventListener('click', () => buyPowerUpFromShop('coinCollector', 'easy'));
            document.getElementById('shop-easy-coin-collector-ad').addEventListener('click', () => watchAdForPowerUpFromShop('coinCollector', 'easy'));
            document.getElementById('shop-easy-shield-buy').addEventListener('click', () => buyPowerUpFromShop('shield', 'easy'));
            document.getElementById('shop-easy-shield-ad').addEventListener('click', () => watchAdForPowerUpFromShop('shield', 'easy'));
            
            // Normal shop purchase buttons
            document.getElementById('shop-normal-double-reward-buy').addEventListener('click', () => buyPowerUpFromShop('doubleReward', 'normal'));
            document.getElementById('shop-normal-double-reward-ad').addEventListener('click', () => watchAdForPowerUpFromShop('doubleReward', 'normal'));
            document.getElementById('shop-normal-coin-collector-buy').addEventListener('click', () => buyPowerUpFromShop('coinCollector', 'normal'));
            document.getElementById('shop-normal-coin-collector-ad').addEventListener('click', () => watchAdForPowerUpFromShop('coinCollector', 'normal'));
            document.getElementById('shop-normal-shield-buy').addEventListener('click', () => buyPowerUpFromShop('shield', 'normal'));
            document.getElementById('shop-normal-shield-ad').addEventListener('click', () => watchAdForPowerUpFromShop('shield', 'normal'));
            
            // Hard shop purchase buttons
            document.getElementById('shop-hard-double-reward-buy').addEventListener('click', () => buyPowerUpFromShop('doubleReward', 'hard'));
            document.getElementById('shop-hard-double-reward-ad').addEventListener('click', () => watchAdForPowerUpFromShop('doubleReward', 'hard'));
            document.getElementById('shop-hard-coin-collector-buy').addEventListener('click', () => buyPowerUpFromShop('coinCollector', 'hard'));
            document.getElementById('shop-hard-coin-collector-ad').addEventListener('click', () => watchAdForPowerUpFromShop('coinCollector', 'hard'));
            document.getElementById('shop-hard-shield-buy').addEventListener('click', () => buyPowerUpFromShop('shield', 'hard'));
            document.getElementById('shop-hard-shield-ad').addEventListener('click', () => watchAdForPowerUpFromShop('shield', 'hard'));
            
            // Game power-up buttons - prevent event bubbling and bird jump
            const doubleRewardBtn = document.getElementById('game-double-reward');
            const coinCollectorBtn = document.getElementById('game-coin-collector');
            const shieldBtn = document.getElementById('game-shield');
            
            // Double reward button
            doubleRewardBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                console.log('Double reward button clicked');
                usePowerUpInGame('doubleReward');
            });
            doubleRewardBtn.addEventListener('touchstart', (e) => {
                e.stopPropagation();
                e.preventDefault();
                console.log('Double reward button touched');
                usePowerUpInGame('doubleReward');
            });
            
            // Coin collector button
            coinCollectorBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                console.log('Coin collector button clicked');
                usePowerUpInGame('coinCollector');
            });
            coinCollectorBtn.addEventListener('touchstart', (e) => {
                e.stopPropagation();
                e.preventDefault();
                console.log('Coin collector button touched');
                usePowerUpInGame('coinCollector');
            });
            
            // Shield button
            shieldBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                e.preventDefault();
                console.log('Shield button clicked');
                usePowerUpInGame('shield');
            });
            shieldBtn.addEventListener('touchstart', (e) => {
                e.stopPropagation();
                e.preventDefault();
                console.log('Shield button touched');
                usePowerUpInGame('shield');
            });
            
            // Pause menu buttons
            document.getElementById('resume-button').addEventListener('click', startResumeCountdown);
            document.getElementById('restart-button').addEventListener('click', () => {
                pauseMenu.classList.add('hidden');
                clearGameElements();
                startGame(difficulty);
            });
            document.getElementById('exit-to-menu-button').addEventListener('click', showMainMenu);
            

            
            // Game profile button
            document.getElementById('profile-button-game').addEventListener('click', () => {
                pauseGame();
                showProfile();
            });
            
            // Password toggle buttons
            document.getElementById('toggle-login-password').addEventListener('click', () => togglePasswordVisibility('login-password', 'login-eye-closed', 'login-eye-open'));
            document.getElementById('toggle-register-password').addEventListener('click', () => togglePasswordVisibility('register-password', 'register-eye-closed', 'register-eye-open'));
            document.getElementById('toggle-register-confirm-password').addEventListener('click', () => togglePasswordVisibility('register-confirm-password', 'register-confirm-eye-closed', 'register-confirm-eye-open'));
            document.getElementById('toggle-current-password').addEventListener('click', () => togglePasswordVisibility('current-password', 'current-eye-closed', 'current-eye-open'));
            document.getElementById('toggle-new-password').addEventListener('click', () => togglePasswordVisibility('new-password', 'new-eye-closed', 'new-eye-open'));
            document.getElementById('toggle-confirm-new-password').addEventListener('click', () => togglePasswordVisibility('confirm-new-password', 'confirm-new-eye-closed', 'confirm-new-eye-open'));
            
            // Withdrawal success modal
            document.getElementById('close-success-modal').addEventListener('click', closeWithdrawalSuccessModal);
            
            // Blocked account modal
            document.getElementById('contact-support-blocked').addEventListener('click', () => {
                document.getElementById('blocked-account-modal').classList.add('hidden');
                showContactSupport();
            });
            document.getElementById('close-blocked-modal').addEventListener('click', () => {
                document.getElementById('blocked-account-modal').classList.add('hidden');
                handleLogout();
            });
            
            // Contact support modal
            document.getElementById('close-contact-support').addEventListener('click', closeContactSupport);
            
            // Game controls
            document.addEventListener('keydown', handleKeyDown);
            gameContainer.addEventListener('click', handleClick);
            gameContainer.addEventListener('touchstart', handleTouch);
        }
        
        function handleKeyDown(e) {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                if (gameActive && !countdownActive) {
                    birdJump();
                }
                e.preventDefault();
            }
        }
        
        function handleClick(e) {
            // Check if click is on a power-up button or its children
            const powerUpButton = e.target.closest('#game-power-ups button');
            if (powerUpButton) {
                console.log('Power-up button clicked via game container');
                return; // Don't make bird jump if clicking power-up buttons
            }
            
            if (gameActive && !countdownActive) {
                birdJump();
            }
        }
        
        function handleTouch(e) {
            // Check if touch is on a power-up button or its children
            const powerUpButton = e.target.closest('#game-power-ups button');
            if (powerUpButton) {
                console.log('Power-up button touched via game container');
                return; // Don't make bird jump if touching power-up buttons
            }
            
            if (gameActive && !countdownActive) {
                birdJump();
                e.preventDefault();
            }
        }
        
        // Auth screen functions
        function showAuthScreen() {
            stopGame();
            clearGameElements();
            
            document.getElementById('auth-screen').classList.remove('hidden');
            mainMenu.classList.add('hidden');
            difficultyMenu.classList.add('hidden');
            howToPlayMenu.classList.add('hidden');
            highScoresMenu.classList.add('hidden');
            gameHistoryMenu.classList.add('hidden');
            withdrawalMenu.classList.add('hidden');
            gameOverMenu.classList.add('hidden');
            pauseMenu.classList.add('hidden');
            document.getElementById('profile-button-game').classList.add('hidden');
            countdownOverlay.classList.add('hidden');
            
            // Clear forms
            clearAuthForms();
            hideAuthError();
        }
        
        function showLoginForm() {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('register-form').classList.add('hidden');
            hideAuthError();
        }
        
        function showRegisterForm() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
            hideAuthError();
        }
        
        function clearAuthForms() {
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('register-username').value = '';
            document.getElementById('register-email').value = '';
            document.getElementById('register-password').value = '';
            document.getElementById('register-confirm-password').value = '';
        }
        
        function showAuthError(message) {
            const errorDiv = document.getElementById('auth-error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }
        
        function hideAuthError() {
            document.getElementById('auth-error').classList.add('hidden');
        }
        
        async function handleLogin() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showAuthError('Please fill in all fields');
                return;
            }
            
            const loginButton = document.getElementById('login-button');
            loginButton.textContent = 'Logging in...';
            loginButton.disabled = true;
            
            const result = await loginUser(email, password);
            
            if (result.success) {
                // Success handled by auth state listener
                clearAuthForms();
            } else {
                showAuthError(result.error);
            }
            
            loginButton.textContent = 'Login';
            loginButton.disabled = false;
        }
        
        async function handleRegister() {
            const username = document.getElementById('register-username').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            if (!username || !email || !password || !confirmPassword) {
                showAuthError('Please fill in all fields');
                return;
            }
            
            // Username validation
            if (username.length < 3) {
                showAuthError('Username must be at least 3 characters long');
                return;
            }
            
            if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                showAuthError('Username can only contain letters, numbers, and underscores');
                return;
            }
            
            if (password.length < 6) {
                showAuthError('Password must be at least 6 characters long');
                return;
            }
            
            if (password !== confirmPassword) {
                showAuthError('Passwords do not match');
                return;
            }
            
            const registerButton = document.getElementById('register-button');
            registerButton.textContent = 'Creating Account...';
            registerButton.disabled = true;
            
            const result = await registerUser(email, password, username);
            
            if (result.success) {
                // Success handled by auth state listener
                clearAuthForms();
            } else {
                showAuthError(result.error);
            }
            
            registerButton.textContent = 'Register';
            registerButton.disabled = false;
        }
        
        async function handleLogout() {
            try {
                // Show loading state
                const logoutButton = document.getElementById('profile-logout-button');
                if (logoutButton) {
                    logoutButton.textContent = 'Logging out...';
                    logoutButton.disabled = true;
                }
                
                // Stop any active game immediately
                stopGame();
                clearGameElements();
                
                // Try Firebase logout first
                let firebaseLogoutSuccess = false;
                
                if (window.firebaseAuth && window.firebaseAuthMethods) {
                    try {
                        const { signOut } = window.firebaseAuthMethods;
                        await signOut(window.firebaseAuth);
                        firebaseLogoutSuccess = true;
                        console.log('Firebase logout successful');
                    } catch (firebaseError) {
                        console.error('Firebase logout failed:', firebaseError);
                        // Continue with manual logout
                    }
                }
                
                // Complete manual logout - reset ALL application state
                currentUser = null;
                totalBalance = 0;
                totalWithdrawals = 0;
                withdrawalCount = 0;
                money = 0;
                difficulty = 'normal';
                selectedDifficulty = 'normal';
                gameSession = null;
                
                // Reset high scores to default
                highScores = {
                    easy: [0, 0, 0],
                    normal: [0, 0, 0],
                    hard: [0, 0, 0]
                };
                
                // Clear all history
                gameHistory = [];
                withdrawalHistory = [];
                savedPaymentAccounts = {
                    upi: [],
                    bank: []
                };
                
                // Reset power-up inventory
                powerUpInventory = {
                    easy: { doubleReward: 0, coinCollector: 0, shield: 0 },
                    normal: { doubleReward: 0, coinCollector: 0, shield: 0 },
                    hard: { doubleReward: 0, coinCollector: 0, shield: 0 }
                };
                
                // Reset active power-ups
                activePowerUps = {
                    doubleReward: false,
                    coinCollector: false,
                    shield: false
                };
                powerUpTimers = {
                    doubleReward: 0,
                    coinCollector: 0,
                    shield: 0
                };
                shieldUsesLeft = 0;
                
                // Clear ALL localStorage data
                try {
                    // Clear specific flappy bird keys
                    const keys = Object.keys(localStorage);
                    keys.forEach(key => {
                        if (key.startsWith('flappyBird')) {
                            localStorage.removeItem(key);
                        }
                    });
                    
                    // Also clear any other potential cached data
                    localStorage.clear();
                } catch (storageError) {
                    console.warn('Could not clear localStorage:', storageError);
                }
                
                // Clear any session storage
                try {
                    sessionStorage.clear();
                } catch (sessionError) {
                    console.warn('Could not clear sessionStorage:', sessionError);
                }
                
                // Reset all game variables to initial state
                gameActive = false;
                countdownActive = false;
                bird = null;
                pipes = [];
                clouds = [];
                coins = [];
                lastPipeTime = 0;
                gameStartTime = null;
                
                // Reset logout button
                if (logoutButton) {
                    logoutButton.textContent = 'Logout';
                    logoutButton.disabled = false;
                }
                
                // Force complete UI reset - hide ALL menus and modals
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('main-menu').classList.add('hidden');
                document.getElementById('difficulty-menu').classList.add('hidden');
                document.getElementById('how-to-play').classList.add('hidden');
                document.getElementById('high-scores').classList.add('hidden');
                document.getElementById('game-history').classList.add('hidden');
                document.getElementById('withdrawal-menu').classList.add('hidden');
                document.getElementById('withdrawal-history-menu').classList.add('hidden');
                document.getElementById('profile-menu').classList.add('hidden');
                document.getElementById('change-password-menu').classList.add('hidden');
                document.getElementById('shopping-menu').classList.add('hidden');
                document.getElementById('payment-details-menu').classList.add('hidden');
                document.getElementById('withdrawal-success-modal').classList.add('hidden');
                document.getElementById('blocked-account-modal').classList.add('hidden');
                document.getElementById('contact-support-modal').classList.add('hidden');
                document.getElementById('game-over').classList.add('hidden');
                document.getElementById('pause-menu').classList.add('hidden');
                document.getElementById('loading-screen').classList.add('hidden');
                document.getElementById('countdown-overlay').classList.add('hidden');
                
                // Hide game elements
                document.getElementById('profile-button-game').classList.add('hidden');
                document.getElementById('game-power-ups').classList.add('hidden');
                document.getElementById('power-up-timers').classList.add('hidden');
                birdElement.classList.add('hidden');
                
                // Reset auth forms to login form (default state)
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('register-form').classList.add('hidden');
                
                // Clear all form inputs
                clearAuthForms();
                hideAuthError();
                
                // Clear password forms
                document.getElementById('current-password').value = '';
                document.getElementById('new-password').value = '';
                document.getElementById('confirm-new-password').value = '';
                document.getElementById('password-error').classList.add('hidden');
                document.getElementById('password-success').classList.add('hidden');
                
                // Clear withdrawal forms
                document.getElementById('withdrawal-amount').value = '';
                document.getElementById('withdrawal-error').classList.add('hidden');
                
                // Reset payment forms
                resetPaymentMethodSelection();
                
                // Show success message
                showNotification('Logged out successfully! Please login again.', 'success');
                
                console.log('Complete logout successful - user returned to fresh state');
                
            } catch (error) {
                console.error('Logout error:', error);
                
                // Force complete reset even if there are errors
                currentUser = null;
                totalBalance = 0;
                gameHistory = [];
                
                // Reset logout button
                const logoutButton = document.getElementById('profile-logout-button');
                if (logoutButton) {
                    logoutButton.textContent = 'Logout';
                    logoutButton.disabled = false;
                }
                
                // Force show auth screen
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('main-menu').classList.add('hidden');
                document.getElementById('profile-menu').classList.add('hidden');
                
                // Clear forms
                clearAuthForms();
                
                showNotification('Logged out successfully!', 'success');
            }
        }
        
        function showMainMenu() {
            stopGame();
            clearGameElements();
            
            document.getElementById('auth-screen').classList.add('hidden');
            mainMenu.classList.remove('hidden');
            difficultyMenu.classList.add('hidden');
            howToPlayMenu.classList.add('hidden');
            highScoresMenu.classList.add('hidden');
            gameHistoryMenu.classList.add('hidden');
            withdrawalMenu.classList.add('hidden');
            document.getElementById('withdrawal-history-menu').classList.add('hidden');
            document.getElementById('profile-menu').classList.add('hidden');
            document.getElementById('change-password-menu').classList.add('hidden');
            document.getElementById('shopping-menu').classList.add('hidden');
            document.getElementById('payment-details-menu').classList.add('hidden');
            document.getElementById('withdrawal-success-modal').classList.add('hidden');
            gameOverMenu.classList.add('hidden');
            pauseMenu.classList.add('hidden');
            document.getElementById('profile-button-game').classList.add('hidden');
            document.getElementById('game-power-ups').classList.add('hidden');
            countdownOverlay.classList.add('hidden');
            
            // Hide bird when not in game
            birdElement.classList.add('hidden');
            
            // Update user display
            updateUserDisplay();
        }
        
        function showWithdrawalHistory() {
            mainMenu.classList.add('hidden');
            document.getElementById('withdrawal-history-menu').classList.remove('hidden');
            updateWithdrawalHistoryDisplay();
        }
        
        function updateWithdrawalHistoryDisplay() {
            const historyContainer = document.getElementById('withdrawal-history-container');
            const noHistoryMessage = document.getElementById('no-withdrawal-history-message');
            
            // Update summary stats
            document.getElementById('history-total-withdrawn').textContent = formatMoney(totalWithdrawals);
            document.getElementById('history-total-requests').textContent = withdrawalCount.toString();
            
            // Clear previous history items
            while (historyContainer.firstChild) {
                historyContainer.removeChild(historyContainer.firstChild);
            }
            
            // Show message if no history
            if (withdrawalHistory.length === 0) {
                historyContainer.appendChild(noHistoryMessage);
                return;
            } else {
                if (noHistoryMessage && noHistoryMessage.parentNode === historyContainer) {
                    noHistoryMessage.remove();
                }
            }
            
            // Add history items
            withdrawalHistory.forEach((withdrawal, index) => {
                const withdrawalDate = new Date(withdrawal.date);
                const formattedDate = formatDate(withdrawalDate);
                
                const historyItem = document.createElement('div');
                historyItem.className = 'bg-white border border-gray-200 rounded-xl p-4 shadow-sm';
                
                // Determine status color and icon
                let statusColor, statusIcon, statusText, statusBg;
                switch (withdrawal.status) {
                    case 'completed':
                        statusColor = 'text-green-800';
                        statusBg = 'bg-green-100 border-green-200';
                        statusIcon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                        statusText = 'Completed';
                        break;
                    case 'processing':
                        statusColor = 'text-yellow-800';
                        statusBg = 'bg-yellow-100 border-yellow-200';
                        statusIcon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
                        statusText = 'Processing';
                        break;
                    case 'rejected':
                        statusColor = 'text-red-800';
                        statusBg = 'bg-red-100 border-red-200';
                        statusIcon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>';
                        statusText = 'Rejected';
                        break;
                    default:
                        statusColor = 'text-blue-800';
                        statusBg = 'bg-blue-100 border-blue-200';
                        statusIcon = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>';
                        statusText = 'Pending';
                }
                
                historyItem.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <div class="text-lg font-bold text-gray-800">${formatMoney(withdrawal.amount)}</div>
                            <div class="text-sm text-gray-600 font-medium">${formattedDate}</div>
                        </div>
                        <div class="text-right">
                            <div class="${statusBg} ${statusColor} text-xs px-3 py-2 rounded-full font-bold flex items-center border shadow-sm">
                                <span class="mr-2">${statusIcon}</span>
                                ${statusText}
                            </div>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-3">
                        <div class="flex justify-between text-sm mb-2">
                            <span class="text-gray-600 font-medium">Method:</span>
                            <span class="font-bold text-gray-800">${withdrawal.method === 'upi' ? 'UPI Payment' : 'Bank Transfer'}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600 font-medium">Reference:</span>
                            <span class="font-mono text-xs bg-gray-100 px-2 py-1 rounded border">${withdrawal.referenceId}</span>
                        </div>
                        ${withdrawal.status === 'rejected' && withdrawal.reason ? `
                        <div class="mt-3 p-3 bg-red-50 border-2 border-red-200 rounded-lg text-sm text-red-700">
                            <div class="flex items-center mb-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                                <strong>Rejection Reason:</strong>
                            </div>
                            <p>${withdrawal.reason}</p>
                        </div>
                        ` : ''}
                        ${withdrawal.status === 'processing' ? `
                        <div class="mt-3 p-3 bg-yellow-50 border-2 border-yellow-200 rounded-lg text-sm text-yellow-700">
                            <div class="flex items-center mb-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <strong>Processing Status:</strong>
                            </div>
                            <p>Your withdrawal is being processed. Money will be transferred within 24 hours.</p>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                historyContainer.appendChild(historyItem);
            });
        }
        
        function togglePasswordVisibility(inputId, eyeClosedId, eyeOpenId) {
            const input = document.getElementById(inputId);
            const eyeClosed = document.getElementById(eyeClosedId);
            const eyeOpen = document.getElementById(eyeOpenId);
            
            if (input.type === 'password') {
                input.type = 'text';
                eyeClosed.classList.add('hidden');
                eyeOpen.classList.remove('hidden');
            } else {
                input.type = 'password';
                eyeClosed.classList.remove('hidden');
                eyeOpen.classList.add('hidden');
            }
        }
        
        function closeWithdrawalSuccessModal() {
            document.getElementById('withdrawal-success-modal').classList.add('hidden');
            showMainMenu();
        }
        
        function showBlockedAccountModal(reason) {
            document.getElementById('block-reason').textContent = reason;
            document.getElementById('blocked-account-modal').classList.remove('hidden');
        }
        
        function showContactSupport() {
            // Hide other modals first
            document.getElementById('profile-menu').classList.add('hidden');
            document.getElementById('blocked-account-modal').classList.add('hidden');
            
            // Show contact support modal
            document.getElementById('contact-support-modal').classList.remove('hidden');
        }
        
        function closeContactSupport() {
            document.getElementById('contact-support-modal').classList.add('hidden');
            
            // Return to profile menu if it was open before
            if (currentUser && !currentUser.isBlocked) {
                showProfile();
            }
        }
        
        function showProfile() {
            mainMenu.classList.add('hidden');
            document.getElementById('profile-menu').classList.remove('hidden');
            updateProfileDisplay();
        }
        
        function showChangePassword() {
            document.getElementById('profile-menu').classList.add('hidden');
            document.getElementById('change-password-menu').classList.remove('hidden');
            clearPasswordForm();
        }
        
        function backToProfile() {
            document.getElementById('change-password-menu').classList.add('hidden');
            document.getElementById('profile-menu').classList.remove('hidden');
            clearPasswordForm();
        }
        
        function clearPasswordForm() {
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-new-password').value = '';
            document.getElementById('password-error').classList.add('hidden');
            document.getElementById('password-success').classList.add('hidden');
        }
        
        async function handlePasswordChange() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-new-password').value;
            
            // Clear previous messages
            document.getElementById('password-error').classList.add('hidden');
            document.getElementById('password-success').classList.add('hidden');
            
            // Validation
            if (!currentPassword || !newPassword || !confirmPassword) {
                showPasswordError('Please fill in all fields');
                return;
            }
            
            if (newPassword.length < 6) {
                showPasswordError('New password must be at least 6 characters long');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showPasswordError('New passwords do not match');
                return;
            }
            
            const updateButton = document.getElementById('update-password-button');
            updateButton.textContent = 'Updating...';
            updateButton.disabled = true;
            
            try {
                const { reauthenticateWithCredential, EmailAuthProvider, updatePassword } = window.firebaseAuthMethods;
                const user = window.firebaseAuth.currentUser;
                
                // Re-authenticate user
                const credential = EmailAuthProvider.credential(user.email, currentPassword);
                await reauthenticateWithCredential(user, credential);
                
                // Update password
                await updatePassword(user, newPassword);
                
                showPasswordSuccess('Password updated successfully!');
                clearPasswordForm();
                
                setTimeout(() => {
                    showProfile();
                }, 2000);
                
            } catch (error) {
                if (error.code === 'auth/wrong-password') {
                    showPasswordError('Current password is incorrect');
                } else if (error.code === 'auth/weak-password') {
                    showPasswordError('New password is too weak');
                } else {
                    showPasswordError('Error updating password: ' + error.message);
                }
            }
            
            updateButton.textContent = 'Update Password';
            updateButton.disabled = false;
        }
        
        function showPasswordError(message) {
            const errorDiv = document.getElementById('password-error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }
        
        function showPasswordSuccess(message) {
            const successDiv = document.getElementById('password-success');
            successDiv.textContent = message;
            successDiv.classList.remove('hidden');
        }
        
        function showDifficultyMenu() {
            mainMenu.classList.add('hidden');
            difficultyMenu.classList.remove('hidden');
        }
        
        function showShopping() {
            mainMenu.classList.add('hidden');
            document.getElementById('shopping-menu').classList.remove('hidden');
            switchShopTab('easy'); // Default to easy tab
            updateShoppingDisplay();
        }
        
        function switchShopTab(tab) {
            const tabs = ['easy', 'normal', 'hard'];
            const tabButtons = {
                'easy': document.getElementById('shop-easy-tab'),
                'normal': document.getElementById('shop-normal-tab'),
                'hard': document.getElementById('shop-hard-tab')
            };
            const tabContents = {
                'easy': document.getElementById('shop-easy-content'),
                'normal': document.getElementById('shop-normal-content'),
                'hard': document.getElementById('shop-hard-content')
            };
            
            tabs.forEach(t => {
                if (t === tab) {
                    tabButtons[t].classList.add('active');
                    tabContents[t].classList.remove('hidden');
                } else {
                    tabButtons[t].classList.remove('active');
                    tabContents[t].classList.add('hidden');
                }
            });
        }
        
        function updateShoppingDisplay() {
            // Ensure all difficulty inventories exist
            ['easy', 'normal', 'hard'].forEach(diff => {
                if (!powerUpInventory[diff]) {
                    powerUpInventory[diff] = {
                        doubleReward: 0,
                        coinCollector: 0,
                        shield: 0
                    };
                }
            });
            
            // Update easy shop counts
            document.getElementById('easy-double-reward-count').textContent = powerUpInventory.easy.doubleReward || 0;
            document.getElementById('easy-coin-collector-count').textContent = powerUpInventory.easy.coinCollector || 0;
            document.getElementById('easy-shield-count').textContent = powerUpInventory.easy.shield || 0;
            
            // Update normal shop counts
            document.getElementById('normal-double-reward-count').textContent = powerUpInventory.normal.doubleReward || 0;
            document.getElementById('normal-coin-collector-count').textContent = powerUpInventory.normal.coinCollector || 0;
            document.getElementById('normal-shield-count').textContent = powerUpInventory.normal.shield || 0;
            
            // Update hard shop counts
            document.getElementById('hard-double-reward-count').textContent = powerUpInventory.hard.doubleReward || 0;
            document.getElementById('hard-coin-collector-count').textContent = powerUpInventory.hard.coinCollector || 0;
            document.getElementById('hard-shield-count').textContent = powerUpInventory.hard.shield || 0;
        }
        
        function buyPowerUpFromShop(powerType, shopDifficulty) {
            const prices = { easy: 1, normal: 2, hard: 3 };
            const price = prices[shopDifficulty];
            
            if (totalBalance >= price) {
                totalBalance -= price;
                powerUpInventory[shopDifficulty][powerType]++;
                updateUserDisplay();
                updateShoppingDisplay();
                saveData();
                showNotification(`Power-up purchased for ${shopDifficulty} mode! ${formatMoney(price)} deducted.`, 'success');
            } else {
                showNotification(`Insufficient balance! Need ${formatMoney(price)}.`, 'error');
            }
        }
        
        function watchAdForPowerUpFromShop(powerType, shopDifficulty) {
            showNotification('Watching ad... Please wait 5 seconds.', 'info');
            
            setTimeout(() => {
                powerUpInventory[shopDifficulty][powerType]++;
                updateShoppingDisplay();
                saveData();
                showNotification(`Ad completed! Power-up received for ${shopDifficulty} mode!`, 'success');
            }, 5000);
        }
        
        function usePowerUpInGame(powerType) {
            console.log('usePowerUpInGame called with:', powerType);
            console.log('Current difficulty:', difficulty);
            console.log('Power-up inventory:', powerUpInventory);
            
            // Ensure power-up inventory exists for current difficulty
            if (!powerUpInventory[difficulty]) {
                powerUpInventory[difficulty] = {
                    doubleReward: 0,
                    coinCollector: 0,
                    shield: 0
                };
            }
            
            console.log('Active power-ups:', activePowerUps);
            console.log('Power-up count for', powerType, ':', powerUpInventory[difficulty][powerType]);
            
            // Check if power-up is already active
            if (activePowerUps[powerType]) {
                console.log('Power-up already active');
                showNotification('Power-up already active!', 'error');
                return;
            }
            
            // Check if user has this power-up in inventory for current difficulty
            if ((powerUpInventory[difficulty][powerType] || 0) <= 0) {
                console.log('No power-up available');
                showNotification(`No ${getPowerUpName(powerType)} available for ${difficulty} mode! Buy from shop.`, 'error');
                return;
            }
            
            console.log('Using power-up:', powerType);
            
            // Use power-up
            powerUpInventory[difficulty][powerType] = (powerUpInventory[difficulty][powerType] || 0) - 1;
            activatePowerUp(powerType);
            updateGamePowerUpDisplay();
            saveData();
            showNotification(`${getPowerUpName(powerType)} activated!`, 'success');
        }
        
        function activatePowerUp(powerType) {
            activePowerUps[powerType] = true;
            powerUpTimers[powerType] = 30; // 30 seconds
            
            if (powerType === 'shield') {
                shieldUsesLeft = 2; // Can pass through 2 pipes
            }
            
            // Track power-up usage for session analytics
            if (gameSession) {
                gameSession.powerUpsUsed.push({
                    type: powerType,
                    timestamp: new Date(),
                    difficulty: difficulty
                });
            }
            
            // Log power-up usage activity
            logUserActivity('powerup_used', {
                sessionId: gameSession ? gameSession.sessionId : 'unknown',
                powerType: powerType,
                difficulty: difficulty,
                timestamp: new Date(),
                totalPowerUpsUsed: gameSession ? gameSession.powerUpsUsed.length : 0
            });
        }
        
        function updateGamePowerUpDisplay() {
            // Only update if we're in a game and have a difficulty set
            if (!difficulty) return;
            
            // Ensure power-up inventory exists for current difficulty
            if (!powerUpInventory[difficulty]) {
                powerUpInventory[difficulty] = {
                    doubleReward: 0,
                    coinCollector: 0,
                    shield: 0
                };
            }
            
            // Update counts
            const doubleRewardCount = powerUpInventory[difficulty].doubleReward || 0;
            const coinCollectorCount = powerUpInventory[difficulty].coinCollector || 0;
            const shieldCount = powerUpInventory[difficulty].shield || 0;
            
            document.getElementById('game-double-reward-count').textContent = doubleRewardCount;
            document.getElementById('game-coin-collector-count').textContent = coinCollectorCount;
            document.getElementById('game-shield-count').textContent = shieldCount;
            
            // Update button states - enable if count > 0 and not already active
            const doubleRewardBtn = document.getElementById('game-double-reward');
            const coinCollectorBtn = document.getElementById('game-coin-collector');
            const shieldBtn = document.getElementById('game-shield');
            
            doubleRewardBtn.disabled = doubleRewardCount <= 0 || activePowerUps.doubleReward;
            coinCollectorBtn.disabled = coinCollectorCount <= 0 || activePowerUps.coinCollector;
            shieldBtn.disabled = shieldCount <= 0 || activePowerUps.shield;
            
            // Add visual feedback for enabled/disabled states
            if (doubleRewardBtn.disabled) {
                doubleRewardBtn.classList.add('opacity-50', 'cursor-not-allowed');
                doubleRewardBtn.classList.remove('hover:scale-105');
                doubleRewardBtn.style.pointerEvents = 'none';
            } else {
                doubleRewardBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                doubleRewardBtn.classList.add('hover:scale-105');
                doubleRewardBtn.style.pointerEvents = 'auto';
            }
            
            if (coinCollectorBtn.disabled) {
                coinCollectorBtn.classList.add('opacity-50', 'cursor-not-allowed');
                coinCollectorBtn.classList.remove('hover:scale-105');
                coinCollectorBtn.style.pointerEvents = 'none';
            } else {
                coinCollectorBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                coinCollectorBtn.classList.add('hover:scale-105');
                coinCollectorBtn.style.pointerEvents = 'auto';
            }
            
            if (shieldBtn.disabled) {
                shieldBtn.classList.add('opacity-50', 'cursor-not-allowed');
                shieldBtn.classList.remove('hover:scale-105');
                shieldBtn.style.pointerEvents = 'none';
            } else {
                shieldBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                shieldBtn.classList.add('hover:scale-105');
                shieldBtn.style.pointerEvents = 'auto';
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg text-white font-bold max-w-sm`;
            
            switch (type) {
                case 'success':
                    notification.classList.add('bg-green-500');
                    break;
                case 'error':
                    notification.classList.add('bg-red-500');
                    break;
                case 'info':
                default:
                    notification.classList.add('bg-blue-500');
                    break;
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        function showHowToPlay() {
            mainMenu.classList.add('hidden');
            howToPlayMenu.classList.remove('hidden');
        }
        
        function showHighScores() {
            mainMenu.classList.add('hidden');
            highScoresMenu.classList.remove('hidden');
            switchScoresTab('easy');
        }
        
        function switchScoresTab(tab) {
            const tabs = ['easy', 'normal', 'hard'];
            const tabButtons = {
                'easy': document.getElementById('easy-scores-tab'),
                'normal': document.getElementById('normal-scores-tab'),
                'hard': document.getElementById('hard-scores-tab')
            };
            const tabContents = {
                'easy': document.getElementById('easy-scores-content'),
                'normal': document.getElementById('normal-scores-content'),
                'hard': document.getElementById('hard-scores-content')
            };
            
            tabs.forEach(t => {
                if (t === tab) {
                    tabButtons[t].classList.add('active');
                    tabContents[t].classList.remove('hidden');
                } else {
                    tabButtons[t].classList.remove('active');
                    tabContents[t].classList.add('hidden');
                }
            });
        }
        
        function updateHighScoresDisplay() {
            // Update easy scores
            document.getElementById('easy-high-score').textContent = formatMoney(highScores.easy[0]);
            document.getElementById('easy-second-score').textContent = formatMoney(highScores.easy[1]);
            document.getElementById('easy-third-score').textContent = formatMoney(highScores.easy[2]);
            
            // Update normal scores
            document.getElementById('normal-high-score').textContent = formatMoney(highScores.normal[0]);
            document.getElementById('normal-second-score').textContent = formatMoney(highScores.normal[1]);
            document.getElementById('normal-third-score').textContent = formatMoney(highScores.normal[2]);
            
            // Update hard scores
            document.getElementById('hard-high-score').textContent = formatMoney(highScores.hard[0]);
            document.getElementById('hard-second-score').textContent = formatMoney(highScores.hard[1]);
            document.getElementById('hard-third-score').textContent = formatMoney(highScores.hard[2]);
        }
        
        function showGameHistory() {
            mainMenu.classList.add('hidden');
            gameHistoryMenu.classList.remove('hidden');
            updateGameHistoryDisplay();
        }
        
        function showWithdrawal() {
            mainMenu.classList.add('hidden');
            withdrawalMenu.classList.remove('hidden');
            updateWithdrawalDisplay();
        }
        
        let selectedWithdrawalAmount = 0;
        let selectedPaymentMethod = '';
        
        function updateWithdrawalDisplay() {
            document.getElementById('total-balance').textContent = formatMoney(totalBalance);
            
            const proceedButton = document.getElementById('proceed-withdrawal-button');
            const insufficientFunds = document.getElementById('insufficient-funds');
            const withdrawalAvailable = document.getElementById('withdrawal-available');
            
            if (totalBalance >= 100) {
                insufficientFunds.classList.add('hidden');
                withdrawalAvailable.classList.remove('hidden');
            } else {
                proceedButton.disabled = true;
                insufficientFunds.classList.remove('hidden');
                withdrawalAvailable.classList.add('hidden');
            }
            
            // Clear withdrawal amount input
            document.getElementById('withdrawal-amount').value = '';
            document.getElementById('withdrawal-error').classList.add('hidden');
            proceedButton.disabled = true;
        }
        
        function validateWithdrawalAmount() {
            const amountInput = document.getElementById('withdrawal-amount');
            const errorDiv = document.getElementById('withdrawal-error');
            const proceedButton = document.getElementById('proceed-withdrawal-button');
            
            const amount = parseFloat(amountInput.value);
            
            // Clear previous errors
            errorDiv.classList.add('hidden');
            
            if (isNaN(amount) || amount <= 0) {
                proceedButton.disabled = true;
                return;
            }
            
            if (amount < 100) {
                errorDiv.textContent = 'Minimum withdrawal amount is ₹100.00';
                errorDiv.classList.remove('hidden');
                proceedButton.disabled = true;
                return;
            }
            
            if (amount > totalBalance) {
                errorDiv.textContent = `Insufficient balance! You have ${formatMoney(totalBalance)}`;
                errorDiv.classList.remove('hidden');
                proceedButton.disabled = true;
                return;
            }
            
            // Valid amount
            selectedWithdrawalAmount = amount;
            proceedButton.disabled = false;
        }
        
        function proceedToPayment() {
            if (selectedWithdrawalAmount < 100 || selectedWithdrawalAmount > totalBalance) {
                return;
            }
            
            // Hide withdrawal menu and show payment details
            document.getElementById('withdrawal-menu').classList.add('hidden');
            document.getElementById('payment-details-menu').classList.remove('hidden');
            
            // Update withdrawal summary
            document.getElementById('withdrawal-summary-amount').textContent = formatMoney(selectedWithdrawalAmount);
            
            // Reset payment method selection and load saved accounts
            resetPaymentMethodSelection();
        }
        
        function backToWithdrawal() {
            document.getElementById('payment-details-menu').classList.add('hidden');
            document.getElementById('withdrawal-menu').classList.remove('hidden');
        }
        
        function selectPaymentMethod(event) {
            const option = event.currentTarget;
            const method = option.dataset.method;
            
            // Remove selection from all options
            document.querySelectorAll('.payment-method-option').forEach(opt => {
                opt.classList.remove('border-blue-500', 'bg-blue-50');
                opt.classList.add('border-gray-200');
                const radio = opt.querySelector('.payment-method-radio');
                radio.classList.remove('bg-blue-500', 'border-blue-500');
                radio.classList.add('border-gray-300');
                radio.innerHTML = '';
            });
            
            // Select current option
            option.classList.remove('border-gray-200');
            option.classList.add('border-blue-500', 'bg-blue-50');
            const radio = option.querySelector('.payment-method-radio');
            radio.classList.remove('border-gray-300');
            radio.classList.add('bg-blue-500', 'border-blue-500');
            radio.innerHTML = '<div class="w-2 h-2 bg-white rounded-full mx-auto mt-1"></div>';
            
            selectedPaymentMethod = method;
            
            // Show/hide relevant forms
            document.getElementById('upi-details').classList.add('hidden');
            document.getElementById('bank-details').classList.add('hidden');
            
            if (method === 'upi') {
                document.getElementById('upi-details').classList.remove('hidden');
            } else if (method === 'bank') {
                document.getElementById('bank-details').classList.remove('hidden');
            }
            
            // Enable confirm button
            document.getElementById('confirm-withdrawal-button').disabled = false;
            
            // Clear any previous errors
            document.getElementById('payment-error').classList.add('hidden');
        }
        
        function resetPaymentMethodSelection() {
            // Reset all payment method options
            document.querySelectorAll('.payment-method-option').forEach(opt => {
                opt.classList.remove('border-blue-500', 'bg-blue-50');
                opt.classList.add('border-gray-200');
                const radio = opt.querySelector('.payment-method-radio');
                radio.classList.remove('bg-blue-500', 'border-blue-500');
                radio.classList.add('border-gray-300');
                radio.innerHTML = '';
            });
            
            // Hide all forms
            document.getElementById('upi-details').classList.add('hidden');
            document.getElementById('bank-details').classList.add('hidden');
            
            // Clear form inputs
            document.getElementById('upi-id').value = '';
            document.getElementById('upi-name').value = '';
            document.getElementById('account-number').value = '';
            document.getElementById('ifsc-code').value = '';
            document.getElementById('account-holder-name').value = '';
            document.getElementById('bank-name').value = '';
            
            // Reset dropdowns
            document.getElementById('upi-account-select').value = '';
            document.getElementById('bank-account-select').value = '';
            
            // Reset checkboxes
            document.getElementById('save-upi-account').checked = false;
            document.getElementById('save-bank-account').checked = false;
            
            // Disable confirm button
            document.getElementById('confirm-withdrawal-button').disabled = true;
            selectedPaymentMethod = '';
            
            // Clear errors
            document.getElementById('payment-error').classList.add('hidden');
            
            // Load saved accounts
            loadSavedAccounts();
        }
        
        function loadSavedAccounts() {
            // Load UPI accounts
            const upiSelect = document.getElementById('upi-account-select');
            upiSelect.innerHTML = '<option value="">Select saved account or add new</option>';
            
            if (savedPaymentAccounts.upi && savedPaymentAccounts.upi.length > 0) {
                savedPaymentAccounts.upi.forEach((account, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${account.upiId} - ${account.accountHolderName}`;
                    upiSelect.appendChild(option);
                });
            }
            
            // Load Bank accounts
            const bankSelect = document.getElementById('bank-account-select');
            bankSelect.innerHTML = '<option value="">Select saved account or add new</option>';
            
            if (savedPaymentAccounts.bank && savedPaymentAccounts.bank.length > 0) {
                savedPaymentAccounts.bank.forEach((account, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${account.bankName} - ****${account.accountNumber.slice(-4)}`;
                    bankSelect.appendChild(option);
                });
            }
        }
        
        function loadSavedUpiAccount() {
            const selectElement = document.getElementById('upi-account-select');
            const selectedIndex = selectElement.value;
            
            if (selectedIndex !== '' && savedPaymentAccounts.upi[selectedIndex]) {
                const account = savedPaymentAccounts.upi[selectedIndex];
                document.getElementById('upi-id').value = account.upiId;
                document.getElementById('upi-name').value = account.accountHolderName;
                document.getElementById('save-upi-account').checked = false; // Already saved
            } else {
                // Clear form if "add new" is selected
                document.getElementById('upi-id').value = '';
                document.getElementById('upi-name').value = '';
                document.getElementById('save-upi-account').checked = false;
            }
        }
        
        function loadSavedBankAccount() {
            const selectElement = document.getElementById('bank-account-select');
            const selectedIndex = selectElement.value;
            
            if (selectedIndex !== '' && savedPaymentAccounts.bank[selectedIndex]) {
                const account = savedPaymentAccounts.bank[selectedIndex];
                document.getElementById('account-number').value = account.accountNumber;
                document.getElementById('ifsc-code').value = account.ifscCode;
                document.getElementById('account-holder-name').value = account.accountHolderName;
                document.getElementById('bank-name').value = account.bankName;
                document.getElementById('save-bank-account').checked = false; // Already saved
            } else {
                // Clear form if "add new" is selected
                document.getElementById('account-number').value = '';
                document.getElementById('ifsc-code').value = '';
                document.getElementById('account-holder-name').value = '';
                document.getElementById('bank-name').value = '';
                document.getElementById('save-bank-account').checked = false;
            }
        }
        
        function savePaymentAccount(method, accountData) {
            if (method === 'upi') {
                // Check if account already exists
                const exists = savedPaymentAccounts.upi.some(account => 
                    account.upiId === accountData.upiId
                );
                
                if (!exists && savedPaymentAccounts.upi.length < 5) {
                    savedPaymentAccounts.upi.push({
                        upiId: accountData.upiId,
                        accountHolderName: accountData.accountHolderName,
                        savedAt: new Date()
                    });
                    saveData();
                    showNotification('UPI account saved successfully!', 'success');
                } else if (exists) {
                    showNotification('UPI account already saved!', 'info');
                } else {
                    showNotification('Maximum 5 UPI accounts allowed!', 'error');
                }
            } else if (method === 'bank') {
                // Check if account already exists
                const exists = savedPaymentAccounts.bank.some(account => 
                    account.accountNumber === accountData.accountNumber && 
                    account.ifscCode === accountData.ifscCode
                );
                
                if (!exists && savedPaymentAccounts.bank.length < 5) {
                    savedPaymentAccounts.bank.push({
                        accountNumber: accountData.accountNumber,
                        ifscCode: accountData.ifscCode,
                        accountHolderName: accountData.accountHolderName,
                        bankName: accountData.bankName,
                        savedAt: new Date()
                    });
                    saveData();
                    showNotification('Bank account saved successfully!', 'success');
                } else if (exists) {
                    showNotification('Bank account already saved!', 'info');
                } else {
                    showNotification('Maximum 5 bank accounts allowed!', 'error');
                }
            }
        }
        
        async function processWithdrawal() {
            const errorDiv = document.getElementById('payment-error');
            errorDiv.classList.add('hidden');
            
            // Validate payment method selection
            if (!selectedPaymentMethod) {
                errorDiv.textContent = 'Please select a payment method';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            let paymentDetails = '';
            let fullPaymentDetails = {};
            
            // Validate form fields based on selected method
            if (selectedPaymentMethod === 'upi') {
                const upiId = document.getElementById('upi-id').value.trim();
                const upiName = document.getElementById('upi-name').value.trim();
                
                if (!upiId || !upiName) {
                    errorDiv.textContent = 'Please fill in all UPI details';
                    errorDiv.classList.remove('hidden');
                    return;
                }
                
                // Basic UPI ID validation
                if (!upiId.includes('@') || upiId.length < 5) {
                    errorDiv.textContent = 'Please enter a valid UPI ID';
                    errorDiv.classList.remove('hidden');
                    return;
                }
                
                paymentDetails = upiId;
                fullPaymentDetails = {
                    upiId: upiId,
                    accountHolderName: upiName
                };
                
                // Save account if checkbox is checked
                if (document.getElementById('save-upi-account').checked) {
                    savePaymentAccount('upi', fullPaymentDetails);
                }
                
            } else if (selectedPaymentMethod === 'bank') {
                const accountNumber = document.getElementById('account-number').value.trim();
                const ifscCode = document.getElementById('ifsc-code').value.trim();
                const accountHolderName = document.getElementById('account-holder-name').value.trim();
                const bankName = document.getElementById('bank-name').value.trim();
                
                if (!accountNumber || !ifscCode || !accountHolderName || !bankName) {
                    errorDiv.textContent = 'Please fill in all bank details';
                    errorDiv.classList.remove('hidden');
                    return;
                }
                
                // Basic validation
                if (accountNumber.length < 8) {
                    errorDiv.textContent = 'Please enter a valid account number';
                    errorDiv.classList.remove('hidden');
                    return;
                }
                
                if (ifscCode.length !== 11) {
                    errorDiv.textContent = 'IFSC code must be 11 characters';
                    errorDiv.classList.remove('hidden');
                    return;
                }
                
                paymentDetails = `${bankName} - ${accountNumber}`;
                fullPaymentDetails = {
                    accountNumber: accountNumber,
                    ifscCode: ifscCode,
                    accountHolderName: accountHolderName,
                    bankName: bankName
                };
                
                // Save account if checkbox is checked
                if (document.getElementById('save-bank-account').checked) {
                    savePaymentAccount('bank', fullPaymentDetails);
                }
            }
            
            // Process withdrawal
            const confirmButton = document.getElementById('confirm-withdrawal-button');
            confirmButton.textContent = 'Processing...';
            confirmButton.disabled = true;
            
            try {
                // Generate reference ID
                const referenceId = 'WD' + Date.now().toString().slice(-9);
                const withdrawalDate = new Date();
                
                // STEP 1: SABSE PEHLE "MAIN OFFICE REGISTER" MEIN LIKHO
                // Pehle withdrawals collection mein document banao - Admin Panel ke liye zaroori!
                let withdrawalDocumentSaved = false;
                let withdrawalDocId = null;
                
                if (!window.firebaseDbMethods || !window.firebaseDb || !currentUser) {
                    console.error('❌ CRITICAL: Firebase not available - cannot save to Main Office Register');
                    errorDiv.textContent = 'Service temporarily unavailable. Please try again later.';
                    errorDiv.classList.remove('hidden');
                    
                    confirmButton.textContent = 'Confirm Withdrawal';
                    confirmButton.disabled = false;
                    return;
                }
                
                try {
                    const { collection, addDoc } = window.firebaseDbMethods;
                    
                    // Main Office Register ke liye complete withdrawal document
                    const withdrawalDocument = {
                        // User Information - Admin Panel ke liye
                        userId: currentUser.uid,
                        username: currentUser.username || 'Unknown',
                        email: currentUser.email,
                        
                        // Withdrawal Details - Exact requirements
                        amount: selectedWithdrawalAmount,
                        method: selectedPaymentMethod,
                        paymentDetails: fullPaymentDetails, // Complete object as requested
                        status: 'processing', // Hamesha 'processing' - as requested
                        requestedAt: withdrawalDate, // Current timestamp - as requested
                        referenceId: referenceId,
                        
                        // Additional Admin Panel Information
                        userTotalBalance: totalBalance, // Balance before withdrawal
                        userBalanceAfterWithdrawal: totalBalance - selectedWithdrawalAmount,
                        userTotalWithdrawals: totalWithdrawals + selectedWithdrawalAmount,
                        userWithdrawalCount: withdrawalCount + 1,
                        
                        // Request Tracking
                        requestIP: await getUserIP(),
                        userAgent: navigator.userAgent,
                        requestTimestamp: withdrawalDate,
                        
                        // Admin Control Fields
                        processedAt: null,
                        completedAt: null,
                        adminNotes: '',
                        processedBy: null,
                        rejectionReason: null,
                        
                        // System Info
                        gameVersion: '1.0',
                        platform: 'web'
                    };
                    
                    // MAIN OFFICE REGISTER mein save karo - withdrawals collection
                    console.log('📝 Saving to Main Office Register (withdrawals collection)...');
                    const docRef = await addDoc(collection(window.firebaseDb, 'withdrawals'), withdrawalDocument);
                    withdrawalDocId = docRef.id;
                    
                    console.log('✅ SUCCESS: Withdrawal saved to Main Office Register with ID:', docRef.id);
                    console.log('📋 Admin Panel can now see this request in withdrawals collection');
                    withdrawalDocumentSaved = true;
                    
                    // Log activity for tracking
                    await logUserActivity('withdrawal_requested', {
                        withdrawalDocId: docRef.id,
                        amount: selectedWithdrawalAmount,
                        method: selectedPaymentMethod,
                        referenceId: referenceId,
                        timestamp: withdrawalDate,
                        userBalance: totalBalance - selectedWithdrawalAmount
                    });
                    
                } catch (firebaseError) {
                    console.error('❌ CRITICAL ERROR: Failed to save to Main Office Register:', firebaseError);
                    
                    // User ko error dikhao - Main Office Register mein save nahi hua
                    errorDiv.textContent = 'Failed to submit withdrawal request to admin system. Please try again.';
                    errorDiv.classList.remove('hidden');
                    
                    confirmButton.textContent = 'Confirm Withdrawal';
                    confirmButton.disabled = false;
                    
                    // IMPORTANT: Return here - agar Main Office Register mein save nahi hua to aage mat badho
                    return;
                }
                
                // STEP 2: SIRF TAB USER KI "PERSONAL DIARY" UPDATE KARO JAB STEP 1 SAFAL HO
                // Main Office Register mein successfully save hone ke baad hi user data update karo
                if (withdrawalDocumentSaved) {
                    console.log('📖 Now updating user Personal Diary...');
                    
                    // User ke Personal Diary ke liye chota record
                    const personalWithdrawalRecord = {
                        date: withdrawalDate,
                        amount: selectedWithdrawalAmount,
                        method: selectedPaymentMethod,
                        paymentDetails: paymentDetails, // Simple string for user display
                        status: 'processing',
                        referenceId: referenceId,
                        withdrawalDocId: withdrawalDocId, // Link to Main Office Register
                        reason: null // For rejected withdrawals
                    };
                    
                    // Personal Diary mein add karo
                    withdrawalHistory.unshift(personalWithdrawalRecord);
                    
                    // History limit maintain karo
                    if (withdrawalHistory.length > 50) {
                        withdrawalHistory = withdrawalHistory.slice(0, 50);
                    }
                    
                    // IMPORTANT: Balance tabhi kato jab Main Office Register mein save ho gaya ho
                    console.log('💰 Deducting balance - Main Office Register save successful');
                    totalBalance -= selectedWithdrawalAmount;
                    totalWithdrawals += selectedWithdrawalAmount;
                    withdrawalCount++;
                    
                    // User data save karo (Personal Diary)
                    await saveData();
                    
                    // Success modal dikhao
                    showWithdrawalSuccessModal(selectedWithdrawalAmount, selectedPaymentMethod, paymentDetails, referenceId);
                    
                    // Form reset karo
                    selectedWithdrawalAmount = 0;
                    selectedPaymentMethod = '';
                    confirmButton.textContent = 'Confirm Withdrawal';
                    confirmButton.disabled = false;
                    
                    // Menu hide karo
                    document.getElementById('payment-details-menu').classList.add('hidden');
                    
                    // Display update karo
                    updateUserDisplay();
                    
                    // Success notification
                    showNotification('✅ Withdrawal request submitted successfully! Admin will process within 24 hours.', 'success');
                    
                    console.log('🎉 COMPLETE SUCCESS: Withdrawal saved to both Main Office Register and Personal Diary');
                    console.log('📋 Admin Panel Integration: Document ID =', withdrawalDocId);
                    console.log('💰 User Balance Updated: New Balance =', totalBalance);
                }
                
            } catch (error) {
                console.error('❌ Unexpected error in withdrawal process:', error);
                errorDiv.textContent = 'An unexpected error occurred. Please try again.';
                errorDiv.classList.remove('hidden');
                
                confirmButton.textContent = 'Confirm Withdrawal';
                confirmButton.disabled = false;
            }
        }
        
        function showWithdrawalSuccessModal(amount, method, details, referenceId) {
            // Update modal content
            document.getElementById('success-withdrawal-amount').textContent = formatMoney(amount);
            document.getElementById('success-payment-method').textContent = method === 'upi' ? 'UPI Payment' : 'Bank Transfer';
            document.getElementById('success-payment-details').textContent = details;
            document.getElementById('success-reference-id').textContent = referenceId;
            
            // Show modal
            document.getElementById('withdrawal-success-modal').classList.remove('hidden');
        }
        
        function updateGameHistoryDisplay() {
            const historyContainer = document.getElementById('history-container');
            const noHistoryMessage = document.getElementById('no-history-message');
            
            // Clear previous history items
            while (historyContainer.firstChild) {
                historyContainer.removeChild(historyContainer.firstChild);
            }
            
            // Show message if no history
            if (gameHistory.length === 0) {
                historyContainer.appendChild(noHistoryMessage);
                return;
            } else {
                if (noHistoryMessage.parentNode === historyContainer) {
                    noHistoryMessage.remove();
                }
            }
            
            // Add history items
            gameHistory.forEach((game, index) => {
                const gameDate = new Date(game.date);
                const formattedDate = formatDate(gameDate);
                
                const historyItem = document.createElement('div');
                historyItem.className = 'game-card p-4 rounded-xl';
                
                // Determine difficulty color
                let difficultyColor;
                switch (game.difficulty) {
                    case 'easy':
                        difficultyColor = 'green';
                        break;
                    case 'normal':
                        difficultyColor = 'yellow';
                        break;
                    case 'hard':
                        difficultyColor = 'red';
                        break;
                }
                
                historyItem.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold">${formattedDate}</span>
                        <span class="bg-${difficultyColor}-100 text-${difficultyColor}-800 text-xs px-2 py-1 rounded-full capitalize">${game.difficulty}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-700">Earned:</span>
                        <span class="font-bold text-lg">${formatMoney(game.money)}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-700">Time Played:</span>
                        <span>${formatTime(game.duration)}</span>
                    </div>
                `;
                
                historyContainer.appendChild(historyItem);
            });
        }
        
        function formatDate(date) {
            const now = new Date();
            const yesterday = new Date(now);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (date.toDateString() === now.toDateString()) {
                return `Today, ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
            } else if (date.toDateString() === yesterday.toDateString()) {
                return `Yesterday, ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
            } else {
                return `${date.toLocaleDateString([], { month: 'short', day: 'numeric' })}, ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
            }
        }
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            
            if (minutes === 0) {
                return `${remainingSeconds}s`;
            } else {
                return `${minutes}m ${remainingSeconds}s`;
            }
        }
        
        function showGameOver() {
            gameActive = false;
            clearInterval(gameLoop);
            
            // Hide bird and game elements
            birdElement.classList.add('hidden');
            document.getElementById('profile-button-game').classList.add('hidden');
            
            // Calculate game session data
            const gameEndTime = new Date();
            const gameDuration = Math.floor((gameEndTime - gameStartTime) / 1000);
            
            // Complete game session tracking
            if (gameSession) {
                gameSession.endTime = gameEndTime;
                gameSession.duration = gameDuration;
                gameSession.finalMoney = money;
                gameSession.finalBalance = totalBalance + money;
            }
            
            // Log comprehensive game over activity
            logUserActivity('game_ended', {
                sessionId: gameSession ? gameSession.sessionId : 'unknown',
                difficulty: difficulty,
                duration: gameDuration,
                moneyEarned: money,
                pipesPassedCount: gameSession ? gameSession.pipesPassedCount : 0,
                coinsCollectedCount: gameSession ? gameSession.coinsCollectedCount : 0,
                jumpCount: gameSession ? gameSession.jumpCount : 0,
                powerUpsUsed: gameSession ? gameSession.powerUpsUsed : [],
                maxHeight: gameSession ? gameSession.maxHeight : 0,
                minHeight: gameSession ? gameSession.minHeight : 0,
                finalBalance: totalBalance + money,
                timestamp: gameEndTime,
                userAgent: navigator.userAgent
            });
            
            // Update game over screen
            document.getElementById('final-earnings').textContent = `Earned: ${formatMoney(money)}`;
            document.getElementById('difficulty-display').textContent = `Difficulty: ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)}`;
            
            // Get best score for current difficulty
            const bestScore = highScores[difficulty][0];
            document.getElementById('best-earnings-display').textContent = formatMoney(bestScore);
            
            // Set medal based on score compared to best score
            const medalElement = document.getElementById('game-over-medal');
            medalElement.className = 'medal mx-auto mb-6 pulsing';
            
            if (money >= bestScore) {
                medalElement.classList.add('gold');
            } else if (money >= bestScore * 0.7) {
                medalElement.classList.add('silver');
            } else if (money >= bestScore * 0.4) {
                medalElement.classList.add('bronze');
            } else {
                medalElement.classList.add('bg-gray-300');
            }
            
            // Add earnings to total balance
            totalBalance += money;
            
            // Save game to history with enhanced data
            const gameHistoryEntry = {
                date: gameEndTime,
                difficulty: difficulty,
                money: money,
                duration: gameDuration,
                pipesPassedCount: gameSession ? gameSession.pipesPassedCount : 0,
                coinsCollectedCount: gameSession ? gameSession.coinsCollectedCount : 0,
                jumpCount: gameSession ? gameSession.jumpCount : 0,
                powerUpsUsed: gameSession ? gameSession.powerUpsUsed.length : 0,
                sessionId: gameSession ? gameSession.sessionId : 'unknown'
            };
            
            gameHistory.unshift(gameHistoryEntry);
            
            // Limit history to 20 entries
            if (gameHistory.length > 20) {
                gameHistory = gameHistory.slice(0, 20);
            }
            
            // Update high scores if needed
            updateHighScores();
            
            // Update profile display to reflect new games played count
            updateProfileDisplay();
            
            // Save data with validation
            saveData();
            
            // Reset game session
            gameSession = null;
            
            // Show game over screen
            gameOverMenu.classList.remove('hidden');
        }
        
        function updateHighScores() {
            // Add current money to high scores array
            highScores[difficulty].push(money);
            
            // Sort scores in descending order
            highScores[difficulty].sort((a, b) => b - a);
            
            // Keep only top 3
            highScores[difficulty] = highScores[difficulty].slice(0, 3);
            
            // Update high scores display
            updateHighScoresDisplay();
        }
        
        function pauseGame() {
            if (!gameActive || countdownActive) return;
            
            gameActive = false;
            clearInterval(gameLoop);
            
            // Update pause menu
            document.getElementById('pause-current-earnings').textContent = formatMoney(money);
            
            // Show pause menu
            pauseMenu.classList.remove('hidden');
        }
        
        // Start the countdown before resuming the game
        function startResumeCountdown() {
            // Hide pause menu
            pauseMenu.classList.add('hidden');
            
            // Show countdown overlay
            countdownOverlay.classList.remove('hidden');
            countdownNumber.textContent = '3';
            
            // Set countdown active flag
            countdownActive = true;
            
            // Start countdown
            let count = 3;
            const countdownInterval = setInterval(() => {
                count--;
                
                if (count > 0) {
                    // Update countdown number with animation
                    countdownNumber.style.animation = 'none';
                    void countdownNumber.offsetWidth; // Trigger reflow
                    countdownNumber.style.animation = 'countdownPulse 1s ease-in-out';
                    countdownNumber.textContent = count;
                } else {
                    // Countdown finished
                    clearInterval(countdownInterval);
                    countdownOverlay.classList.add('hidden');
                    countdownActive = false;
                    resumeGame();
                }
            }, 1000);
        }
        
        function resumeGame() {
            gameActive = true;
            gameLoop = setInterval(updateGame, 20);
        }
        
        // Function to clear all game elements (pipes and clouds)
        function clearGameElements() {
            // Remove all pipes
            const pipeElements = document.querySelectorAll('.pipe');
            pipeElements.forEach(pipe => {
                pipe.remove();
            });
            pipes = [];
            
            // Remove all clouds
            const cloudElements = document.querySelectorAll('.cloud');
            cloudElements.forEach(cloud => {
                cloud.remove();
            });
            clouds = [];
            
            // Remove all coins
            coins.forEach(coin => {
                if (coin.element.parentNode) {
                    coin.element.parentNode.removeChild(coin.element);
                }
            });
            coins = [];
            
            // Remove all money popups
            const moneyPopups = document.querySelectorAll('.money-popup');
            moneyPopups.forEach(popup => {
                popup.remove();
            });
            
            // Reset power-ups
            activePowerUps = {
                doubleReward: false,
                coinCollector: false,
                shield: false
            };
            powerUpTimers = {
                doubleReward: 0,
                coinCollector: 0,
                shield: 0
            };
            shieldUsesLeft = 0;
            
            // Hide power-up timers
            document.getElementById('power-up-timers').classList.add('hidden');
        }
        
        function startGameWithCountdown(selectedDifficulty) {
            // Hide all menus
            mainMenu.classList.add('hidden');
            difficultyMenu.classList.add('hidden');
            gameOverMenu.classList.add('hidden');
            pauseMenu.classList.add('hidden');
            withdrawalMenu.classList.add('hidden');
            
            // Show loading screen
            showLoadingScreen(selectedDifficulty);
        }
        
        function showLoadingScreen(selectedDifficulty) {
            const loadingScreen = document.getElementById('loading-screen');
            const loadingStatus = document.getElementById('loading-status');
            const loadingProgress = document.getElementById('loading-progress');
            
            // Show loading screen
            loadingScreen.classList.remove('hidden');
            
            // Reset progress
            loadingProgress.style.width = '0%';
            
            // Loading sequence
            const loadingSteps = [
                { text: 'Preparing your adventure...', progress: 20 },
                { text: 'Loading game world...', progress: 40 },
                { text: 'Activating power-ups...', progress: 60 },
                { text: 'Setting up difficulty...', progress: 80 },
                { text: 'Almost ready...', progress: 100 }
            ];
            
            let currentStep = 0;
            
            const loadingInterval = setInterval(() => {
                if (currentStep < loadingSteps.length) {
                    const step = loadingSteps[currentStep];
                    loadingStatus.textContent = step.text;
                    loadingProgress.style.width = step.progress + '%';
                    currentStep++;
                } else {
                    // Loading complete
                    clearInterval(loadingInterval);
                    
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                        startCountdownAfterLoading(selectedDifficulty);
                    }, 500);
                }
            }, 800);
        }
        
        function startCountdownAfterLoading(selectedDifficulty) {
            // Clear any existing game elements
            clearGameElements();
            
            // Show countdown overlay
            countdownOverlay.classList.remove('hidden');
            countdownNumber.textContent = '3';
            
            // Set countdown active flag
            countdownActive = true;
            
            // Start countdown
            let count = 3;
            const countdownInterval = setInterval(() => {
                count--;
                
                if (count > 0) {
                    // Update countdown number with animation
                    countdownNumber.style.animation = 'none';
                    void countdownNumber.offsetWidth; // Trigger reflow
                    countdownNumber.style.animation = 'countdownPulse 1s ease-in-out';
                    countdownNumber.textContent = count;
                } else {
                    // Countdown finished
                    clearInterval(countdownInterval);
                    countdownOverlay.classList.add('hidden');
                    countdownActive = false;
                    startGame(selectedDifficulty);
                }
            }, 1000);
        }
        
        function startGame(selectedDifficulty) {
            // Hide all menus
            mainMenu.classList.add('hidden');
            difficultyMenu.classList.add('hidden');
            gameOverMenu.classList.add('hidden');
            pauseMenu.classList.add('hidden');
            withdrawalMenu.classList.add('hidden');
            countdownOverlay.classList.add('hidden');
            
            // Clear any existing game elements
            clearGameElements();
            
            // Show bird and game elements
            birdElement.classList.remove('hidden');
            document.getElementById('profile-button-game').classList.remove('hidden');
            document.getElementById('game-power-ups').classList.remove('hidden');
            
            // Set difficulty
            difficulty = selectedDifficulty;
            
            // Set difficulty parameters
            switch (difficulty) {
                case 'easy':
                    gravity = 0.4;
                    jumpStrength = -7;
                    pipeSpeed = 2.5;
                    pipeGap = 200;
                    pipeFrequency = 1800;
                    break;
                case 'normal':
                    gravity = 0.5;
                    jumpStrength = -8;
                    pipeSpeed = 3;
                    pipeGap = 180;
                    pipeFrequency = 1500;
                    break;
                case 'hard':
                    gravity = 0.6;
                    jumpStrength = -9;
                    pipeSpeed = 4;
                    pipeGap = 160;
                    pipeFrequency = 1200;
                    break;
            }
            
            // Initialize game state
            money = 0;
            pipes = [];
            clouds = [];
            coins = [];
            lastPipeTime = 0;
            gameStartTime = new Date();
            
            // Initialize game session tracking
            gameSession = {
                startTime: new Date(),
                difficulty: difficulty,
                pipesPassedCount: 0,
                coinsCollectedCount: 0,
                powerUpsUsed: [],
                jumpCount: 0,
                maxHeight: gameHeight / 2,
                minHeight: gameHeight / 2,
                sessionId: generateSessionId()
            };
            
            // Log game start
            logUserActivity('game_started', {
                difficulty: difficulty,
                sessionId: gameSession.sessionId,
                timestamp: new Date(),
                userAgent: navigator.userAgent
            });
            
            // Add some test power-ups for debugging (remove this in production)
            if (!powerUpInventory[difficulty]) {
                powerUpInventory[difficulty] = {
                    doubleReward: 2,
                    coinCollector: 2,
                    shield: 2
                };
            } else {
                // Ensure each power-up has at least 1 for testing
                powerUpInventory[difficulty].doubleReward = Math.max(powerUpInventory[difficulty].doubleReward || 0, 1);
                powerUpInventory[difficulty].coinCollector = Math.max(powerUpInventory[difficulty].coinCollector || 0, 1);
                powerUpInventory[difficulty].shield = Math.max(powerUpInventory[difficulty].shield || 0, 1);
            }
            
            // Update power-up displays
            updatePowerUpDisplay();
            updateGamePowerUpDisplay();
            
            // Create bird
            bird = {
                x: gameWidth / 4,
                y: gameHeight / 2,
                width: 50,
                height: 35,
                velocity: 0,
                passed: []
            };
            
            // Update bird element position
            birdElement.style.left = bird.x + 'px';
            birdElement.style.top = bird.y + 'px';
            birdElement.style.transform = 'rotate(0deg)';
            
            // Update money indicator
            updateMoneyIndicator();
            
            // Create initial clouds
            for (let i = 0; i < 5; i++) {
                createCloud(true);
            }
            
            // Start game loop
            gameActive = true;
            gameLoop = setInterval(updateGame, 20);
        }
        
        // Generate unique session ID
        function generateSessionId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        function stopGame() {
            gameActive = false;
            countdownActive = false;
            if (gameLoop) {
                clearInterval(gameLoop);
            }
        }
        
        function updateGame() {
            if (!gameActive) return;
            
            // Update power-ups
            updatePowerUps();
            
            // Update bird position
            bird.velocity += gravity;
            bird.y += bird.velocity;
            
            // Check if bird hit the ground
            if (bird.y + bird.height > gameHeight - groundHeight) {
                bird.y = gameHeight - groundHeight - bird.height;
                showGameOver();
                return;
            }
            
            // Check if bird hit the ceiling
            if (bird.y < 0) {
                bird.y = 0;
                bird.velocity = 0;
            }
            
            // Update bird element position
            birdElement.style.top = bird.y + 'px';
            
            // Rotate bird based on velocity
            const rotation = Math.min(Math.max(bird.velocity * 3, -30), 90);
            birdElement.style.transform = `rotate(${rotation}deg)`;
            
            // Create new pipes
            const currentTime = Date.now();
            if (currentTime - lastPipeTime > pipeFrequency) {
                createPipe();
                lastPipeTime = currentTime;
            }
            
            // Update pipes
            updatePipes();
            
            // Update clouds
            updateClouds();
            
            // Update coins
            updateCoins();
        }
        
        function updatePowerUps() {
            // Update power-up timers
            Object.keys(powerUpTimers).forEach(powerType => {
                if (activePowerUps[powerType] && powerUpTimers[powerType] > 0) {
                    powerUpTimers[powerType] -= 0.02; // Decrease by 20ms (game loop runs every 20ms)
                    
                    if (powerUpTimers[powerType] <= 0) {
                        activePowerUps[powerType] = false;
                        powerUpTimers[powerType] = 0;
                        
                        if (powerType === 'shield') {
                            shieldUsesLeft = 0;
                        }
                        
                        showNotification(`${getPowerUpName(powerType)} expired!`, 'info');
                        updateGamePowerUpDisplay(); // Refresh button states when power-up expires
                    }
                }
            });
            
            updatePowerUpDisplay();
            updateGamePowerUpDisplay();
        }
        
        function updatePowerUpDisplay() {
            const timersContainer = document.getElementById('power-up-timers');
            let hasActivePowerUps = false;
            
            // Double reward timer
            const doubleRewardTimer = document.getElementById('double-reward-timer');
            if (activePowerUps.doubleReward) {
                doubleRewardTimer.classList.remove('hidden');
                document.getElementById('double-reward-time').textContent = Math.ceil(powerUpTimers.doubleReward);
                hasActivePowerUps = true;
            } else {
                doubleRewardTimer.classList.add('hidden');
            }
            
            // Coin collector timer
            const coinCollectorTimer = document.getElementById('coin-collector-timer');
            if (activePowerUps.coinCollector) {
                coinCollectorTimer.classList.remove('hidden');
                document.getElementById('coin-collector-time').textContent = Math.ceil(powerUpTimers.coinCollector);
                hasActivePowerUps = true;
            } else {
                coinCollectorTimer.classList.add('hidden');
            }
            
            // Shield timer
            const shieldTimer = document.getElementById('shield-timer');
            if (activePowerUps.shield && shieldUsesLeft > 0) {
                shieldTimer.classList.remove('hidden');
                document.getElementById('shield-uses').textContent = shieldUsesLeft;
                hasActivePowerUps = true;
            } else {
                shieldTimer.classList.add('hidden');
            }
            
            // Show/hide timers container
            if (hasActivePowerUps) {
                timersContainer.classList.remove('hidden');
            } else {
                timersContainer.classList.add('hidden');
            }
        }
        
        function birdJump() {
            bird.velocity = jumpStrength;
            
            // Track jump for session analytics
            if (gameSession) {
                gameSession.jumpCount++;
                
                // Track height extremes
                if (bird.y < gameSession.maxHeight) {
                    gameSession.maxHeight = bird.y;
                }
                if (bird.y > gameSession.minHeight) {
                    gameSession.minHeight = bird.y;
                }
            }
        }
        
        function createPipe() {
            // Calculate gap position
            const minGapPosition = 100;
            const maxGapPosition = gameHeight - groundHeight - pipeGap - 100;
            const gapPosition = minGapPosition + Math.random() * (maxGapPosition - minGapPosition);
            
            // Create top pipe
            const topPipe = document.createElement('div');
            topPipe.className = 'pipe pipe-top';
            topPipe.style.left = gameWidth + 'px';
            topPipe.style.height = gapPosition + 'px';
            topPipe.style.top = '0';
            gameContainer.appendChild(topPipe);
            
            // Create bottom pipe
            const bottomPipe = document.createElement('div');
            bottomPipe.className = 'pipe pipe-bottom';
            bottomPipe.style.left = gameWidth + 'px';
            bottomPipe.style.height = (gameHeight - gapPosition - pipeGap - groundHeight) + 'px';
            bottomPipe.style.bottom = groundHeight + 'px';
            gameContainer.appendChild(bottomPipe);
            
            // Add pipes to array
            pipes.push({
                top: topPipe,
                bottom: bottomPipe,
                x: gameWidth,
                width: 70,
                passed: false
            });
        }
        
        function createCloud(initial = false) {
            const cloud = document.createElement('div');
            cloud.className = 'cloud';
            
            // Random cloud size
            const size = 60 + Math.random() * 120;
            cloud.style.width = size + 'px';
            cloud.style.height = size / 2 + 'px';
            
            // Position
            const x = initial ? Math.random() * gameWidth : gameWidth;
            const y = 50 + Math.random() * (gameHeight / 2 - 100);
            cloud.style.left = x + 'px';
            cloud.style.top = y + 'px';
            
            // Speed varies by size (smaller clouds move faster)
            const speed = 1 + (120 - size / 180) / 30;
            
            gameContainer.appendChild(cloud);
            
            clouds.push({
                element: cloud,
                x: x,
                speed: speed
            });
        }
        
        function updatePipes() {
            for (let i = pipes.length - 1; i >= 0; i--) {
                const pipe = pipes[i];
                
                // Move pipe
                pipe.x -= pipeSpeed;
                pipe.top.style.left = pipe.x + 'px';
                pipe.bottom.style.left = pipe.x + 'px';
                
                // Check collision
                if (checkCollision(pipe)) {
                    // Use shield if available
                    if (activePowerUps.shield && shieldUsesLeft > 0) {
                        shieldUsesLeft--;
                        showNotification('Shield used! Safe passage!', 'success');
                        updatePowerUpDisplay();
                        
                        // Mark this pipe as shielded to prevent multiple shield uses on same pipe
                        pipe.shielded = true;
                        
                        // Deactivate shield if no uses left
                        if (shieldUsesLeft <= 0) {
                            activePowerUps.shield = false;
                            powerUpTimers.shield = 0;
                        }
                        
                        // Continue game loop instead of game over
                        continue;
                    } else {
                        showGameOver();
                        return;
                    }
                }
                
                // Check if pipe is passed
                if (!pipe.passed && pipe.x + pipe.width < bird.x) {
                    pipe.passed = true;
                    
                    // Track pipe passing for session analytics
                    if (gameSession) {
                        gameSession.pipesPassedCount++;
                    }
                    
                    // Add money based on difficulty and power-ups
                    let moneyEarned = moneyValues[difficulty];
                    if (activePowerUps.doubleReward) {
                        moneyEarned *= 2;
                    }
                    money += moneyEarned;
                    updateMoneyIndicator();
                    
                    // Create money popup
                    createMoneyPopup(moneyEarned);
                    
                    // Create screen flash effect
                    createScreenFlash();
                    
                    // Log pipe passing activity
                    logUserActivity('pipe_passed', {
                        sessionId: gameSession ? gameSession.sessionId : 'unknown',
                        difficulty: difficulty,
                        moneyEarned: moneyEarned,
                        totalMoney: money,
                        pipesPassedCount: gameSession ? gameSession.pipesPassedCount : 0,
                        timestamp: new Date()
                    });
                    
                    // Create coins if coin collector is active
                    if (activePowerUps.coinCollector) {
                        // Create 2-3 coins per pipe
                        const numCoins = 2 + Math.floor(Math.random() * 2);
                        for (let c = 0; c < numCoins; c++) {
                            setTimeout(() => {
                                createCoin(pipe.x + pipe.width / 2 + (c * 40));
                            }, c * 200);
                        }
                    }
                }
                
                // Remove pipe if off screen
                if (pipe.x + pipe.width < 0) {
                    gameContainer.removeChild(pipe.top);
                    gameContainer.removeChild(pipe.bottom);
                    pipes.splice(i, 1);
                }
            }
        }
        
        function createMoneyPopup(amount, x = null, y = null) {
            // Create money popup element
            const moneyPopup = document.createElement('div');
            moneyPopup.className = 'money-popup';
            
            // Position near the bird or at specified coordinates
            if (x !== null && y !== null) {
                moneyPopup.style.left = x + 'px';
                moneyPopup.style.top = y + 'px';
            } else {
                moneyPopup.style.left = (bird.x + bird.width) + 'px';
                moneyPopup.style.top = (bird.y - 20) + 'px';
            }
            
            // Set text content
            moneyPopup.textContent = '+' + formatMoney(amount);
            
            // Add to game container
            gameContainer.appendChild(moneyPopup);
            
            // Remove after animation completes
            setTimeout(() => {
                if (moneyPopup.parentNode === gameContainer) {
                    gameContainer.removeChild(moneyPopup);
                }
            }, 1500);
        }
        
        function createScreenFlash() {
            // Show and animate the screen flash
            screenFlash.classList.remove('hidden');
            
            // Reset animation
            screenFlash.style.animation = 'none';
            void screenFlash.offsetWidth; // Trigger reflow
            screenFlash.style.animation = 'flashAnimation 0.5s ease-out';
            
            // Hide after animation completes
            setTimeout(() => {
                screenFlash.classList.add('hidden');
            }, 500);
        }
        
        function updateClouds() {
            // Random chance to create a new cloud
            if (Math.random() < 0.005) {
                createCloud();
            }
            
            for (let i = clouds.length - 1; i >= 0; i--) {
                const cloud = clouds[i];
                
                // Move cloud
                cloud.x -= cloud.speed;
                cloud.element.style.left = cloud.x + 'px';
                
                // Remove cloud if off screen
                if (cloud.x + parseFloat(cloud.element.style.width) < 0) {
                    gameContainer.removeChild(cloud.element);
                    clouds.splice(i, 1);
                }
            }
        }
        
        function checkCollision(pipe) {
            // Skip collision if this pipe was already shielded
            if (pipe.shielded) {
                return false;
            }
            
            // Bird bounding box (slightly smaller than visual for better gameplay)
            const birdLeft = bird.x + 5;
            const birdRight = bird.x + bird.width - 5;
            const birdTop = bird.y + 5;
            const birdBottom = bird.y + bird.height - 5;
            
            // Pipe bounding box
            const pipeLeft = pipe.x;
            const pipeRight = pipe.x + pipe.width;
            
            // Check if bird is horizontally within pipe
            if (birdRight > pipeLeft && birdLeft < pipeRight) {
                // Get pipe heights
                const topPipeBottom = parseFloat(pipe.top.style.height);
                const bottomPipeTop = gameHeight - groundHeight - parseFloat(pipe.bottom.style.height);
                
                // Check if bird is vertically colliding with pipes
                if (birdTop < topPipeBottom || birdBottom > bottomPipeTop) {
                    return true;
                }
            }
            
            return false;
        }
        
        function createCoin(x) {
            const coin = document.createElement('div');
            coin.className = 'absolute w-10 h-10 bg-gradient-to-br from-yellow-300 to-yellow-500 rounded-full border-3 border-yellow-600 z-20';
            coin.style.left = x + 'px';
            coin.style.top = (150 + Math.random() * (gameHeight - 400)) + 'px';
            coin.innerHTML = '₹';
            coin.style.display = 'flex';
            coin.style.alignItems = 'center';
            coin.style.justifyContent = 'center';
            coin.style.fontSize = '16px';
            coin.style.fontWeight = 'bold';
            coin.style.color = '#92400e';
            coin.style.boxShadow = '0 4px 8px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.3)';
            coin.style.animation = 'pulse 1s ease-in-out infinite';
            
            gameContainer.appendChild(coin);
            
            coins.push({
                element: coin,
                x: x,
                y: parseFloat(coin.style.top),
                collected: false
            });
        }
        
        function updateCoins() {
            for (let i = coins.length - 1; i >= 0; i--) {
                const coin = coins[i];
                
                // Move coin
                coin.x -= pipeSpeed;
                coin.element.style.left = coin.x + 'px';
                
                // Check collision with bird
                if (!coin.collected && checkCoinCollision(coin)) {
                    coin.collected = true;
                    
                    // Track coin collection for session analytics
                    if (gameSession) {
                        gameSession.coinsCollectedCount++;
                    }
                    
                    // Add coin value to money
                    const coinValue = coinValues[difficulty];
                    money += coinValue;
                    
                    // Create coin popup
                    createMoneyPopup(coinValue, coin.x, coin.y);
                    
                    // Add visual feedback
                    createScreenFlash();
                    showNotification(`Coin collected! +${formatMoney(coinValue)}`, 'success');
                    
                    // Log coin collection activity
                    logUserActivity('coin_collected', {
                        sessionId: gameSession ? gameSession.sessionId : 'unknown',
                        difficulty: difficulty,
                        coinValue: coinValue,
                        totalMoney: money,
                        coinsCollectedCount: gameSession ? gameSession.coinsCollectedCount : 0,
                        timestamp: new Date()
                    });
                    
                    // Remove coin element
                    gameContainer.removeChild(coin.element);
                    coins.splice(i, 1);
                    continue;
                }
                
                // Remove coin if off screen
                if (coin.x + 40 < 0) {
                    gameContainer.removeChild(coin.element);
                    coins.splice(i, 1);
                }
            }
        }
        
        function checkCoinCollision(coin) {
            const birdLeft = bird.x;
            const birdRight = bird.x + bird.width;
            const birdTop = bird.y;
            const birdBottom = bird.y + bird.height;
            
            const coinLeft = coin.x;
            const coinRight = coin.x + 40; // Updated for larger coin size
            const coinTop = coin.y;
            const coinBottom = coin.y + 40; // Updated for larger coin size
            
            return birdRight > coinLeft && birdLeft < coinRight && 
                   birdBottom > coinTop && birdTop < coinBottom;
        }
        
        function updateMoneyIndicator() {
            // Money indicator removed - no longer needed
        }
        
        function getPowerUpName(powerType) {
            switch (powerType) {
                case 'doubleReward':
                    return 'Double Reward';
                case 'coinCollector':
                    return 'Coin Collector';
                case 'shield':
                    return 'Shield';
                default:
                    return 'Power-up';
            }
        }
        
        // Initialize the game when the page loads
        window.addEventListener('load', initGame);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97a76320662fa6dc',t:'MTc1NzA5MjcyMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
